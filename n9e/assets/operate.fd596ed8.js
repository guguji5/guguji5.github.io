var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,n=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,r=(e,r)=>{for(var i in r||(r={}))t.call(r,i)&&n(e,i,r[i]);if(l)for(var i of l(r))a.call(r,i)&&n(e,i,r[i]);return e};import{r as i,w as m,F as s,t as o,$ as u,v as c,R as p,aK as d,y as v,I as g,b as E,c as f,a4 as y,X as _,K as h,g as b,V as k,Z as S,_ as C,aL as $,B as I,k as x}from"./vendor.6a8dc018.js";import{d as V,h as F,X as N,Y as w,i as O,O as q,A as H,Z as P,_ as j,l as B,P as K,$ as L}from"./index.366ccd84.js";const M={all:{label:"周期内所有点",meaning:"在统计周期 $n 秒内（初次上报的指标，统计周期内只有一个值，如要限制点数，可选择happen函数）每个值都 $v",meaningEn:"duration $n s, every value $v",params:[],defaultValue:[]},happen:{label:"发生次数",meaning:"统计周期 $n 秒内至少有 $m 次值 $v",meaningEn:"duration $n s, $m times value $v",params:["m"],defaultValue:[1]},max:{label:"最大值",meaning:"统计周期 $n 秒内的最大值 $v",meaningEn:"duration $n s, max $v",params:[],defaultValue:[]},min:{label:"最小值",meaning:"统计周期 $n 秒内的最小值 $v",meaningEn:"duration $n s, min $v",params:[],defaultValue:[]},avg:{label:"均值",meaning:"统计周期 $n 秒内的均值 $v",meaningEn:"duration $n s, avg $v",params:[],defaultValue:[]},sum:{label:"求和",meaning:"统计周期 $n 秒内的所有值求和 $v",meaningEn:"duration $n s, sum $v",params:[],defaultValue:[]},diff:{label:"突增突降值",meaning:"最新值与其之前 $n 秒内的任意值之差 (区分正负) $v",params:[],defaultValue:[]},pdiff:{label:"突增突降率",meaning:"(最新值与其之前 $n 秒的任意值之差)除以对应历史值 (区分正负) $v ％",params:[],defaultValue:[]},c_avg_rate_abs:{label:"同比变化率",meaning:"最近 $n 秒平均值相对 $m 天前同周期平均值变化率 $v ％",params:["m"],defaultValue:[86400]},c_avg_rate:{label:"同比变化率(区分正负)",meaning:"最近 $n 秒平均值相对 $m 天前同周期平均值变化率 $v ％",params:["m"],defaultValue:[86400]},c_avg_abs:{label:"同比变化值",meaning:"最近 $n 秒平均值相对 $m 天前同周期平均值变化值 $v",params:["m"],defaultValue:[86400]},c_avg:{label:"同比变化值(区分正负)",meaning:"最近 $n 秒平均值相对 $m 天前同周期平均值变化值 $v",params:["m"],defaultValue:[86400]},stddev:{label:"3-sigma离群点检测",meaning:"统计周期 $n 秒内波动值过大，超过了 $m 个标准差范围",meaningEn:"within $n seconds, the fluctuation value exceeds the $m standard deviation range",params:["m"],defaultValue:[3]}},R=[{value:"InClasspath",multiple:!0},{value:"NotInClasspath",multiple:!0},{value:"InClasspathPrefix",multiple:!1},{value:"NotInClasspathPrefix",multiple:!1},{value:"InResourceList",multiple:!0},{value:"NotInResourceList",multiple:!0},{value:"HasPrefixString",multiple:!1},{value:"NoPrefixString",multiple:!1},{value:"HasSuffixString",multiple:!1},{value:"NoSuffixString",multiple:!1},{value:"ContainsString",multiple:!1},{value:"NotContainsString",multiple:!1},{value:"MatchRegexp",multiple:!1},{value:"NotMatchRegexp",multiple:!1}],T=[{value:"InList",multiple:!0},{value:"NotInList",multiple:!0},{value:"HasPrefixString",multiple:!1},{value:"NoPrefixString",multiple:!1},{value:"HasSuffixString",multiple:!1},{value:"NoSuffixString",multiple:!1},{value:"ContainsString",multiple:!1},{value:"NotContainsString",multiple:!1},{value:"MatchRegexp",multiple:!1},{value:"NotMatchRegexp",multiple:!1}],D=e=>{const{field:t,expression:l,alertDuration:a,form:n}=e,[r,g]=i.useState((null==l?void 0:l.func)||"all"),[E,f]=i.useState((null==l?void 0:l.params)||[]),[y,_]=i.useState(void 0!==(null==l?void 0:l.threshold)?null==l?void 0:l.threshold:60),[h,b]=i.useState(null==l?void 0:l.metric),[k,S]=i.useState(""),[C,$]=i.useState([]),[I,x]=i.useState((null==l?void 0:l.optr)||"="),{Option:F}=o;i.useEffect((()=>{h&&V({limit:1,metric:h}).then((e=>{var t,l,a,n,r,i;S((null==(a=null==(l=null==(t=null==e?void 0:e.dat)?void 0:t.metrics)?void 0:l[0])?void 0:a.description)||(null==(i=null==(r=null==(n=null==e?void 0:e.dat)?void 0:n.metrics)?void 0:r[0])?void 0:i.name)||"")})),V({}).then((e=>{var t;$(null==(t=null==e?void 0:e.dat)?void 0:t.metrics)}))}),[]);const N=Object.keys(M).map((e=>i.createElement(F,{key:e,value:e},M[e].label," - ",e))),w=i.useCallback((()=>M[r].params.map(((e,t)=>i.createElement(i.Fragment,{key:t},i.createElement(m,{span:1,style:{lineHeight:"32px",color:"rgb(255, 183, 39)"}},e,"："),i.createElement(m,{span:3},O(t)))))),[r,M[r].params]),O=e=>{const a=["diff","pdiff"].indexOf(r)>-1?2:1;let n;return 0===e&&("c_avg_rate_abs"!==r&&"c_avg_rate"!==r&&"c_avg_abs"!==r&&"c_avg"!==r||(n=i.createElement(o,null,i.createElement(F,{value:86400,key:86400},"1"),i.createElement(F,{value:604800,key:604800},"7"))),"happen"!==r&&"ndiff"!==r&&"stddev"!==r||(n=i.createElement(u,{min:a,style:{width:"100%"}}))),i.createElement(s.Item,{name:[t.name,"params",0],fieldKey:[t.fieldKey,"params"],initialValue:null==l?void 0:l.params[e],style:{marginBottom:0}},n)};i.useEffect((()=>{e.handleMetricChange()}),[]),i.useEffect((()=>()=>{e.handleMetricChange()}),[]);return i.createElement(c,{style:{width:"100%",marginBottom:20}},i.createElement(p,{gutter:[10,10]},i.createElement(m,{span:10},i.createElement(s.Item,{name:[t.name,"metric"],fieldKey:[t.fieldKey,"metric"],initialValue:null==l?void 0:l.metric,style:{marginBottom:0}},i.createElement(d,{onChange:t=>{e.handleMetricChange(),b(t);let l=C.find((e=>e.name===t));l&&S(l.name)},onSearch:v.debounce((e=>{V({metric:e}).then((e=>{var t;$(null==(t=null==e?void 0:e.dat)?void 0:t.metrics)}))}),100),placeholder:"请输入指标"},C&&C.map(((e,t)=>i.createElement(F,{key:t,value:e.name},(e=>e.name+" "+e.description)(e))))))),i.createElement(m,{span:3},i.createElement(s.Item,{name:[t.name,"func"],fieldKey:[t.fieldKey,"func"],initialValue:(null==l?void 0:l.func)||"all",style:{marginBottom:0}},i.createElement(o,{onChange:e=>{g(e)},dropdownClassName:"overflow-230"},N))),w(),i.createElement(m,{span:1,style:{lineHeight:"32px",color:"rgb(255, 111, 39)"}},"v："),i.createElement(m,{span:2},i.createElement(s.Item,{name:[t.name,"optr"],fieldKey:[t.fieldKey,"optr"],initialValue:(null==l?void 0:l.optr)||"=",style:{marginBottom:0}},i.createElement(o,{onChange:e=>{x(e)}},i.createElement(F,{value:"=",key:"equal"},"="),i.createElement(F,{value:">",key:"greater"},">"),i.createElement(F,{value:">=",key:"greaterEqual"},">="),i.createElement(F,{value:"<",key:"less"},"<"),i.createElement(F,{value:"<=",key:"lessEqual"},"<="),i.createElement(F,{value:"!=",key:"notEqual"},"!=")))),i.createElement(m,{span:4},i.createElement(s.Item,{name:[t.name,"threshold"],fieldKey:[t.fieldKey,"threshold"],initialValue:(null==l?void 0:l.threshold)||60,style:{marginBottom:0}},i.createElement(u,{style:{width:"100%"},placeholder:"请输入百分比",onChange:e=>{_(e)}}))),i.createElement(m,{span:24},(()=>{var e;const l=M[r].meaning,m=l.indexOf("$n"),s=l.indexOf("$m"),o=l.lastIndexOf("$v"),u=l.substring(0,m),c=l.substring(o+2);let p;if("c_avg_rate_abs"===r||"c_avg_rate"===r||"c_avg_abs"===r||"c_avg"===r){let l=null==(e=n.getFieldValue("trigger_conditions")[t.name])?void 0:e.params;p=l.length>0&&1!==l[0]?l[0]/86400:1}else p=E[0]||1;let d=i.createElement("strong",{style:{color:"#2DB7F5"}},a);const v=i.createElement("strong",{style:{color:"#FFB727"}},p),g=i.createElement("strong",{style:{color:"#FF6F27"}},I&&void 0!==y?I+" "+y:"${v}");["diff","pdiff"].indexOf(r)>-1&&(d=i.createElement("strong",{style:{color:"#2DB7F5"}},a));let f=i.createElement("span",null,u,d),_=l.substring(m+2);if(s>-1){const e=l.substring(m+2,s);f=i.createElement("span",null,f,e,v),_=l.substring(s+2)}if("stddev"!==r){const e=s>-1?s:m,t=l.substring(e+2,o);f=i.createElement("span",null,f,t,g,c)}else f=i.createElement("span",null,f,_);return i.createElement("div",null,i.createElement("span",{style:{color:"#999"}},"预览："),i.createElement("span",{style:{paddingRight:5}},k||"${metric}"),f)})())))},G=["InResourceList","NotInResourceList"],A=e=>{const{Option:t}=o,{classpathes:l,field:a,initObj:n,onFuncChange:r}=e,[u,c]=i.useState();i.useEffect((()=>{F().then((e=>{c(null==e?void 0:e.dat.list)}))}),[]);const p=R.map((e=>i.createElement(t,{key:e.value,value:e.value},e.value))),d=l.map((e=>i.createElement(t,{key:e.id,value:e.path},e.path))),v=u?u.map((e=>i.createElement(t,{key:e.id,value:e.ident},e.alias+e.ident))):[],[E,f]=i.useState(R[0].value);i.useEffect((()=>{f(null==n?void 0:n.func)}),[null==n?void 0:n.func]);const y=R.filter((e=>e.multiple)).map((e=>e.value));return i.createElement(i.Fragment,null,i.createElement(m,{span:8},i.createElement(s.Item,{name:[a.name,"func"]},i.createElement(o,{value:E,onChange:e=>{r(a.name),f(e)}},p))),i.createElement(m,{span:14},y.includes(E)?i.createElement(s.Item,{name:[a.name,"params"],initialValue:null==n?void 0:n.params},i.createElement(o,{mode:"multiple",value:null==n?void 0:n.params},G.includes(E)?v:d)):i.createElement(s.Item,{name:[a.name,"params",0],initialValue:null==n?void 0:n.params},i.createElement(g,{value:null==n?void 0:n.params}))))},J=T.filter((e=>e.multiple)).map((e=>e.value)),U=e=>{var t;const{Option:l}=o,{tagKeys:a,field:n,initObj:r}=e,[u,c]=i.useState([]),[p,g]=i.useState([]),[E,f]=i.useState([]),[y,_]=i.useState(""),[h,b]=i.useState(""),[k,S]=i.useState((null==r?void 0:r.func)||T[0].value),C=T.map((e=>i.createElement(l,{key:e.value,value:e.value},e.value)));i.useEffect((()=>{(null==r?void 0:r.key)&&0!==(null==a?void 0:a.length)&&N({tag_key:(null==r?void 0:r.key)||a[0],params:[{metric:e.curMetric||""}],limit:50}).then((e=>{var t;c((null==(t=null==e?void 0:e.dat)?void 0:t.values)||[])}))}),[]);const $=i.useCallback(v.debounce((t=>{t&&N({tag_key:t,params:[{metric:e.curMetric||""}],limit:50}).then((e=>{var t;c((null==(t=null==e?void 0:e.dat)?void 0:t.values)||[])}))}),1e3),[]),I=i.useCallback(v.debounce((t=>{_(t);const l={params:[{metric:e.curMetric||""}],limit:50,tag_key:t};w(l).then((e=>{g(e.dat.keys.map((e=>({value:e}))))}))}),1e3),[]),x=i.useCallback(v.debounce((t=>{b(t),N({tag_key:t,params:[{metric:e.curMetric||""}],limit:50}).then((e=>{f(e.dat.values.map((e=>({value:e}))))}))}),1e3),[]),V=e=>{x(e)};return i.createElement(i.Fragment,null,i.createElement(m,{span:8},i.createElement(s.Item,{name:[n.name,"key"],initialValue:(null==r?void 0:r.key)||(null==a?void 0:a[0])},i.createElement(d,{placeholder:"请输入标签key",onChange:e=>{$(e)},onSearch:e=>{I(e)},options:y?p:a.map((e=>({value:e})))}))),i.createElement(m,{span:7},i.createElement(s.Item,{name:[n.name,"func"],initialValue:(null==r?void 0:r.func)||(null==(t=null==T?void 0:T[0])?void 0:t.value)},i.createElement(o,{value:k,onChange:e=>{S(e)}},C))),i.createElement(m,{span:7},i.createElement(s.Item,{name:[n.name,"params"],initialValue:(null==r?void 0:r.params)||(null==u?void 0:u[0])},J.includes(k)?i.createElement(o,{mode:"tags",placeholder:"请输入标签value",onSearch:V},h?E.map((e=>i.createElement(l,{key:e.value,value:e.value},e.value))):(u||[]).map((e=>i.createElement(l,{key:e,value:e},e)))):i.createElement(d,{onSearch:V,options:h?E:(u||[]).map((e=>({value:e})))}))))},{TextArea:X}=g,Z=({onChange:e,value:t})=>i.createElement(i.Fragment,null,i.createElement(u,{onChange:e,value:t})," 秒"),z=[1,2,3,4,5,6,7];const{Option:Y}=o;export default()=>{const e=E(),[t]=s.useForm(),l=new URLSearchParams(f().search).get("mode"),[a,n]=i.useState(60);i.useState({});const[d,F]=i.useState([]),[N,R]=i.useState([]),[T,G]=i.useState([]),[J,Q]=i.useState([]);i.useState(!1);const[W,ee]=i.useState([]),[te,le]=i.useState([]),[ae,ne]=i.useState([]),[re,ie]=i.useState([]),[me,se]=i.useState([]),[oe,ue]=i.useState([]),[ce,pe]=i.useState(!0),[de,ve]=i.useState({}),[ge,Ee]=i.useState([]);i.useState(0);const[fe,ye]=i.useState(),_e=()=>{const e=Promise.resolve(null);return be?j(be):e},he=y(),be=he.id,ke=he.group_id;i.useEffect((()=>{Promise.all([V({limit:150}),O(),q(),H(),P(),_e()]).then((([e,a,n,r,i,m])=>{var s,o,u,c,p,d,v,g,E,f,y,h;let b=null==m?void 0:m.dat;ve(b);let k=[(S="",{optr:"=",func:Object.keys(M)[0],metric:S,params:[],threshold:60})];var S;let C=[],$=[""],I=i||[];t.setFieldsValue({type:0,priority:1,alert_duration:60,status:0,enable_days_of_week:z,enable_time:[_("00:00","HH:mm"),_("23:59","HH:mm")],recovery_duration:0,recovery_notify:false,notify_channels:[],notify_groups:[],notify_users:[],runbook_url:"",note:""}),b&&((null==(o=null==(s=null==b?void 0:b.expression)?void 0:s.trigger_conditions)?void 0:o.length)>0&&(k=null==(u=null==b?void 0:b.expression)?void 0:u.trigger_conditions),(null==(p=null==(c=null==b?void 0:b.expression)?void 0:c.res_filters)?void 0:p.length)>0&&(C=null==(d=null==b?void 0:b.expression)?void 0:d.res_filters,t.setFieldsValue({res_filters:C})),(null==b?void 0:b.callbacks)&&($=null==b?void 0:b.callbacks.split(" ")),(null==b?void 0:b.expression.together_or_any)&&t.setFieldsValue({together_or_any:null==b?void 0:b.expression.together_or_any}),(null==(v=null==b?void 0:b.expression)?void 0:v.evaluation_interval)&&t.setFieldsValue({evaluation_interval:null==(g=null==b?void 0:b.expression)?void 0:g.evaluation_interval}),(null==(E=null==b?void 0:b.expression)?void 0:E.promql)&&t.setFieldsValue({promql:null==(f=null==b?void 0:b.expression)?void 0:f.promql}),b.group_id&&ye(b.group_id),t.setFieldsValue({id:b.id,name:l?"Copy of "+b.name:b.name,priority:b.priority,type:b.type,alert_duration:b.alert_duration,status:b.status,enable_days_of_week:b.enable_days_of_week.split(" ").map((e=>Number(e))),enable_time:[_(b.enable_stime,"HH:mm"),_(b.enable_etime,"HH:mm")],recovery_duration:b.recovery_duration,recovery_notify:b.recovery_notify,notify_channels:b.notify_channels.split(" "),notify_groups:b.notify_groups.length>0?b.notify_groups.split(" ").map((e=>Number(e))):[],notify_users:b.notify_users.length>0?b.notify_users.split(" ").map((e=>Number(e))):[],runbook_url:b.runbook_url,note:b.note,append_tags:b.append_tags?b.append_tags.split(" "):[]})),F(k),R(C),Q($),ue(I);let x=(null==(y=null==n?void 0:n.dat)?void 0:y.list)||[];ie(x);let V=(null==(h=null==r?void 0:r.dat)?void 0:h.list)||[];return se(V),le(e.dat.metrics),ne(a.dat.list),pe(!1),b}))}),[]),i.useEffect((()=>{const e=ge.filter((e=>e));if(0===e.length)return;const l=e.map((e=>({metric:e})));w({limit:50,params:l}).then((e=>{var l,a,n,r;let i=[];de&&(null==(a=null==(l=null==de?void 0:de.expression)?void 0:l.tags_filters)?void 0:a.length)>0&&(i=null==(n=null==de?void 0:de.expression)?void 0:n.tags_filters),G(i),t.setFieldsValue({tags_filters:i}),ee((null==(r=null==e?void 0:e.dat)?void 0:r.keys)||[])}))}),[JSON.stringify(ge)]);const Se=()=>{let e=t.getFieldValue("trigger_conditions").map((e=>e.metric));Ee(e)},Ce={wrapperCol:{offset:2}},$e="一二三四五六日".split("").map(((e,t)=>i.createElement(Y,{value:t+1,key:t},`周${e}`))),Ie=re.map((e=>i.createElement(Y,{value:e.id,key:e.id},e.name))),xe=me.map((e=>i.createElement(Y,{value:e.id,key:e.id},e.username))),Ve=oe.map((e=>i.createElement(h,{value:e,key:e},e))),Fe=e=>{const{res_filters:l}=t.getFieldsValue();l[e].params=[],t.setFieldsValue({res_filters:l})},Ne=v.debounce(((e,t,l)=>{B(t).then((e=>{e.dat.ql_correct?l():l(e.dat.parse_error)}))}),1e3),we=i.createElement(b,{spinning:ce},i.createElement(s,r(r({},{labelCol:{span:2},wrapperCol:{span:22}}),{form:t,onFinish:t=>{var a;let n=JSON.parse(JSON.stringify(t));const{evaluation_interval:r,promql:i,trigger_conditions:m,res_filters:s,tags_filters:o,together_or_any:u}=n;n.expression=0===n.type?{together_or_any:u,trigger_conditions:m,res_filters:s,tags_filters:o}:{evaluation_interval:r,promql:i},delete n.trigger_conditions,delete n.res_filters,delete n.tags_filters,n.enable_days_of_week=n.enable_days_of_week.join(" "),n.enable_stime=t.enable_time[0].format("HH:mm"),n.enable_etime=t.enable_time[1].format("HH:mm"),delete n.enable_time,n.notify_channels=n.notify_channels.join(" "),n.notify_groups=n.notify_groups.join(" "),n.notify_users=n.notify_users.join(" "),n.callbacks=n.callbacks.map((e=>e.url)).join(" "),n.recovery_notify=+n.recovery_notify,n.group_id=Number(ke||fe),(be&&!l?L([n],be):L([n])).then((t=>{""===t.err?(console.log("添加成功",t),x.success(l?"克隆成功":be?"编辑成功":"创建成功"),e.push("/strategy")):x.error(l?"克隆失败":be?"编辑失败":"创建失败")})),n.append_tags=(null==(a=n.append_tags)?void 0:a.join(" "))||""},onFinishFailed:({values:e,errorFields:t,outOfDate:l})=>{var a;console.log("errorFields",t),t.length>0&&(null==(a=document.querySelector(`#${t[0].name[0]}`))||a.scrollIntoView())},className:"strategy-form"}),i.createElement(c,{title:"基本配置"},i.createElement(s.Item,{label:"策略名称",name:"name",rules:[{required:!0,message:"策略名称不能为空"}]},i.createElement(g,{placeholder:"请输入策略名称"})),i.createElement(s.Item,{label:"告警级别",name:"priority",rules:[{required:!0,message:"告警级别不能为空"}]},i.createElement(k.Group,null,i.createElement(k,{value:1},"一级报警"),i.createElement(k,{value:2},"二级报警"),i.createElement(k,{value:3},"三级报警"))),i.createElement(s.Item,{label:"触发模式",name:"type",rules:[{required:!0,message:"触发模式不能为空"}]},i.createElement(k.Group,null,i.createElement(k.Button,{value:0},"nightingale"),i.createElement(k.Button,{value:1},"prometheus"))),i.createElement(s.Item,{label:"统计周期",name:"alert_duration",required:!0},i.createElement(Z,{onChange:e=>{n(e)},value:a})),i.createElement(s.Item,{shouldUpdate:!0,wrapperCol:{span:24}},(()=>0===t.getFieldValue("type")?i.createElement(i.Fragment,null,d.length>0&&i.createElement(s.Item,{label:"触发条件",required:!0,labelCol:{span:2},wrapperCol:{span:22}},i.createElement(s.Item,{name:"together_or_any",initialValue:0},i.createElement(k.Group,null,i.createElement(k.Button,{value:0},"And"),i.createElement(k.Button,{value:1},"Or"))),i.createElement(s.List,{name:"trigger_conditions",initialValue:d,rules:[{validator:async(e,t)=>{if(0===t.length)return Promise.reject(new Error("触发条件不能为空"))}}]},((e,{add:l,remove:n},{errors:r})=>i.createElement(i.Fragment,null,e.length?e.map(((r,s)=>i.createElement(p,{gutter:[10,10],key:r.key},i.createElement(m,{span:22},i.createElement(D,{field:r,remove:n,metrics:te,form:t,expression:d[r.key],alertDuration:a,handleMetricChange:Se})),i.createElement(m,{span:1},i.createElement(S,{className:"control-icon-high",onClick:()=>n(r.name)})),s===e.length-1&&i.createElement(m,{span:1},i.createElement(C,{className:"control-icon-high",onClick:()=>l()}))))):i.createElement(C,{className:"control-icon-high",onClick:()=>l()}),i.createElement(s.ErrorList,{errors:r}))))),i.createElement(s.Item,{label:"资源过滤",labelCol:{span:2},wrapperCol:{span:22}},i.createElement(s.List,{name:"res_filters"},((e,{add:t,remove:l})=>i.createElement(i.Fragment,null,e.length?e.map(((e,a)=>i.createElement(p,{gutter:[10,10],key:e.key},i.createElement(A,{field:e,classpathes:ae,onFuncChange:Fe}),i.createElement(m,{span:1},i.createElement(S,{className:"control-icon-normal",onClick:()=>l(e.name)})),i.createElement(m,{span:1},i.createElement(C,{className:"control-icon-normal",onClick:()=>t()}))))):i.createElement(m,{span:1},i.createElement(C,{className:"control-icon-normal",onClick:()=>t()})))))),i.createElement(s.Item,{label:"标签过滤",labelCol:{span:2},wrapperCol:{span:22}},i.createElement(s.List,{name:"tags_filters"},((e,{add:t,remove:l},{errors:a})=>i.createElement(i.Fragment,null,e.length?e.map(((a,n)=>i.createElement(p,{gutter:[10,10],key:a.key},i.createElement(U,{field:a,tagKeys:W,curMetric:(null==ge?void 0:ge[0])||""}),i.createElement(m,{span:1},i.createElement(S,{className:"control-icon-normal",onClick:()=>l(a.name)})),n===e.length-1&&i.createElement(m,{span:1},i.createElement(C,{className:"control-icon-normal",onClick:()=>t()}))))):i.createElement(m,{span:1},i.createElement(C,{className:"control-icon-normal",onClick:()=>t()}))))))):i.createElement(i.Fragment,null,i.createElement(s.Item,{label:"执行频率",name:"evaluation_interval",labelCol:{span:2},wrapperCol:{span:22},initialValue:10},i.createElement(u,null)),i.createElement(s.Item,{label:"Promeql",name:"promql",labelCol:{span:2},wrapperCol:{span:22},rules:[{required:!0,message:"请输入Promeql"},{validator:Ne}]},i.createElement(X,{rows:2}))))),i.createElement(s.Item,{label:"附加标签",style:{marginTop:20},name:"append_tags"},i.createElement(o,{mode:"tags",onChange:e=>{let t=e[e.length-1];if(t&&!/\w+=\w+/.test(t)){let t=e.pop();x.error(`"${t}"不符合输入规范（格式为key=value）`)}},placeholder:"请输入附加标签，格式为key=value"}))),i.createElement(c,{title:"生效配置",style:{marginTop:20}},i.createElement(s.Item,{label:"立即启用",name:"status"},i.createElement(k.Group,null,i.createElement(k,{value:0},"是"),i.createElement(k,{value:1},"否"))),i.createElement(s.Item,{label:"生效时间",name:"enable_days_of_week"},i.createElement(o,{mode:"tags"},$e)),i.createElement(s.Item,r({name:"enable_time"},Ce),i.createElement($.RangePicker,{format:"HH:mm"}))),i.createElement(c,{title:"通知配置",style:{marginTop:20}},i.createElement(s.Item,{label:"静默恢复",name:"recovery_notify",valuePropName:"checked"},i.createElement(h,null,"不发送恢复通知")),i.createElement(s.Item,{label:"通知媒介",name:"notify_channels"},i.createElement(h.Group,null,Ve)),i.createElement(s.Item,{label:"报警接收团队",name:"notify_groups"},i.createElement(o,{mode:"multiple"},Ie)),i.createElement(s.Item,{label:"报警接收人",name:"notify_users"},i.createElement(o,{mode:"multiple"},xe)),i.createElement(s.Item,{label:"报警回调"},J.length>0&&i.createElement(s.List,{name:"callbacks",initialValue:J},((e,{add:t,remove:l},{errors:a})=>i.createElement(i.Fragment,null,e.length?e.map(((a,n)=>i.createElement(p,{gutter:[10,10],key:a.key},i.createElement(m,{span:22},i.createElement(s.Item,{name:[a.name,"url"],initialValue:J[a.key]},i.createElement(g,null))),i.createElement(m,{span:1},i.createElement(S,{className:"control-icon-normal",onClick:()=>l(a.name)})),n===e.length-1&&i.createElement(m,{span:1},i.createElement(C,{className:"control-icon-normal",onClick:()=>t()}))))):i.createElement(m,{span:1},i.createElement(C,{className:"control-icon-normal",onClick:()=>t()})),i.createElement("span",{style:{fontSize:12,marginTop:4,color:"#ccc"}},"通知自己开发的系统（报警回调, 请确认是 IDC 内可访问的地址）")))))),i.createElement(c,{title:"其他配置",style:{marginTop:20}},i.createElement(s.Item,{label:"应急预案",name:"runbook_url"},i.createElement(g,null)),i.createElement(s.Item,{label:"备注",name:"note"},i.createElement(g,null))),i.createElement("div",{className:"bottom-content"},i.createElement(s.Item,r(r({},Ce),{style:{marginTop:20}}),i.createElement(p,{gutter:[10,10],align:"middle"},i.createElement(m,{span:1},i.createElement(I,{type:"primary",htmlType:"submit"},l?"克隆":be?"编辑":"创建")),i.createElement(m,{span:1,style:{marginLeft:20}},i.createElement(I,null,"取消")))))));return i.createElement(K,{title:"告警策略",showBack:!0},i.createElement(c,{style:{background:"#eee"}},we))};
