var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable,n=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,i=(e,i)=>{for(var c in i||(i={}))t.call(i,c)&&n(e,c,i[c]);if(a)for(var c of a(i))r.call(i,c)&&n(e,c,i[c]);return e};import{F as c,r as s,aH as l,I as o,j as m,B as d,aI as p,aJ as u,l as E,k as f,E as y}from"./vendor.6a8dc018.js";import{S as v,T as h,V as k,P as g,B as b,W as x}from"./index.366ccd84.js";const w=function(e){return v(`${h}/api/n9e/metric-descriptions`,{method:k.Get,params:e})};const{confirm:C}=E,{TextArea:N}=o;export default()=>{const[e]=c.useForm(),t=s.useRef(null),a=s.useRef(null),[r,n]=s.useState(!1),[O,P]=s.useState("create"),[S,j]=s.useState([]),[I,$]=s.useState({}),[L,T]=s.useState(""),F=()=>{n(!1)},q=e=>{var a;(a=[e.id],v(`${h}/api/n9e/metric-descriptions`,{method:k.Delete,data:{ids:a}})).then((async e=>{await t.current.refreshList(),f.success("删除指标成功")}))},[z,B]=s.useState("更多操作"),D=e=>{switch(e){case"import":n(!0),P("import");break;case"export":S.length<=0?f.warning("请勾选需要导出的指标"):(n(!0),P("export"),setTimeout((()=>{a.current&&a.current.focus()})))}B(e)},G=(e,t,a,r)=>t.id===I.id?s.createElement(o,{defaultValue:e,onPressEnter:()=>H("save"),onChange:e=>((e,t,a,r)=>{let n=Object.assign({},t);n[r]=e.target.value,$(n)})(e,t,0,r)}):s.createElement("span",null,e),H=async(e="")=>{if("save"===e){let e=I.id||-1;await function(e,t){return v(`${h}/api/n9e/metric-description/${e}`,{method:k.Put,data:t})}(e,{description:I.description,metric:I.metric}),f.success("编辑成功"),t.current.refreshList()}$({})},R=[{title:"指标名称",dataIndex:"metric",key:"metric",render:e=>s.createElement("a",{style:{color:"black"}},e)},{title:"释义",dataIndex:"description",width:"40%",key:"description",render:(e,t,a)=>G(e,t,0,"description")},{title:"操作",dataIndex:"",key:"operations",width:"15%",render:(e,t)=>s.createElement("div",{className:"operations"},t.id!==I.id?s.createElement("div",null,s.createElement("span",{className:"operation-item edit",onClick:()=>(e=>{$(e)})(t)},"编辑"),s.createElement("div",{className:"table-operator-area-warning",style:{display:"inline-block",marginLeft:10},onClick:()=>{C({title:"确定删除该指标?",icon:s.createElement(y,null),onOk:()=>{q(t)}})}},"删除")):s.createElement("div",null,s.createElement("span",{className:"operation-item edit-save",onClick:()=>H("save")},"保存"),s.createElement("span",{className:"operation-item edit-cancel",onClick:()=>H("cancel")},"取消")))}],V={onChange:(e,t)=>{let a=[];t.map((e=>{a.push(`${e.metric}:${e.description}`)})),j(a)}};return s.createElement(g,{title:"指标释义",icon:s.createElement(l,null)},s.createElement("div",{className:"indicator-index"},s.createElement("div",{className:"indicator-operations"},s.createElement(o,{className:"searchInput",onPressEnter:e=>{let t=e.target.value;T(t)},prefix:s.createElement(m,null),placeholder:"指标名称或释义"}),s.createElement("div",{className:"operations"},s.createElement(d.Group,null,s.createElement(d,{size:"middle",type:"default",icon:s.createElement(p,null),onClick:()=>D("import")},"导入"),s.createElement(d,{size:"middle",type:"default",icon:s.createElement(u,null),onClick:()=>D("export")},"导出")))),s.createElement("div",{className:"indicator-main"},s.createElement(b,{fetchHandle:w,ref:t,fetchParams:{query:L},rowSelection:i({},V),rowKey:e=>e.id,columns:R}))),s.createElement(E,{title:{import:"导入",edit:"编辑",export:"导出",create:"创建"}[O]+"指标",destroyOnClose:!0,footer:"export"!==O&&[s.createElement(d,{key:"delete",onClick:F},"取消"),s.createElement(d,{key:"submit",type:"primary",onClick:async()=>{try{const r=await e.validateFields();(a=r.metrics||"",v(`${h}/api/n9e/metric-descriptions`,{method:k.Post,data:{data:a}})).then((async e=>{e&&e.success&&(await t.current.refreshList(),n(!1),f.success("创建指标成功"))}))}catch(r){}var a}},"确定")],onCancel:F,visible:r},s.createElement("p",{style:{color:"#999"}},"温馨提示：请以([指标名称]:[指标释义])格式进行创建, 如(name:description)。支持多指标创建，请用回车分割。","export"===O&&s.createElement("a",{onClick:()=>{x(S)}},"Download.txt")),(()=>{switch(O){case"export":return s.createElement("div",{contentEditable:"true",suppressContentEditableWarning:!0,ref:a,style:{height:"200px",border:"1px solid #d9d9d9",overflow:"auto",padding:"10px"}},S.map(((e,t)=>s.createElement("div",{key:t},e))));case"import":case"create":return s.createElement(c,{name:O+"-dialog",form:e,preserve:!1},s.createElement(c.Item,{name:"metrics",key:"metrics",rules:[{required:!0,message:"请输入指标详情，格式如[名称]：[释义]",validateTrigger:"trigger"}]},s.createElement(N,{placeholder:"name:description",rows:4})))}})()))};
