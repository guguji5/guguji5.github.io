var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,r=(e,r)=>{for(var s in r||(r={}))t.call(r,s)&&l(e,s,r[s]);if(a)for(var s of a(r))n.call(r,s)&&l(e,s,r[s]);return e},s=(e,l)=>{var r={};for(var s in e)t.call(e,s)&&l.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&a)for(var s of a(e))l.indexOf(s)<0&&n.call(e,s)&&(r[s]=e[s]);return r};import{e as o,a as i,u as c,b as m,c as u,r as d,B as p,M as h,d as E,f,L as g,D as y,S as v,A as k,U as b,g as N,F as _,h as C,I as x,i as w,j as P,k as S,l as $,m as I,T as O,E as D,n as F,o as G,p as T,C as L,q as R,s as A,t as V,v as M,R as z,w as j,x as B,y as H,P as q,z as U,G as K,H as Y,J,K as W,N as Q,O as X,Q as Z,V as ee,W as te,X as ae,Y as ne,Z as le,_ as re,$ as se,a0 as oe,a1 as ie,a2 as ce,a3 as me,a4 as ue,a5 as de,a6 as pe,a7 as he,a8 as Ee,a9 as fe,aa as ge,ab as ye,ac as ve,ad as ke,ae as be,af as Ne,ag as _e,ah as Ce,ai as xe,aj as we,ak as Pe,al as Se,am as $e,an as Ie,ao as Oe,ap as De,aq as Fe,ar as Ge}from"./vendor.6a8dc018.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),l=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,r)=>{const s=new URL(e,n);if(self[t].moduleMap[s])return a(self[t].moduleMap[s]);const o=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){r(new Error(`Failed to import: ${e}`)),l(i)},onload(){a(self[t].moduleMap[s]),l(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/assets/");var Te,Le;(Le=Te||(Te={})).HttpError="HttpError",Le.InterfaceError="InterfaceError";class Re extends Error{constructor(e,t){super(e),this.message=e,this.data=t,this.name=Te.InterfaceError}}const Ae={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"},Ve=o({errorHandler:e=>{const{response:t}=e;if(t&&t.status){const e=t.status in Ae&&Ae[t.status]||t.statusText,{status:a,url:n}=t;i.error({message:`请求错误${a}${n}`,description:e})}else if(!t){const{data:t}=e;i.error({message:(null==t?void 0:t.err)||"您的网络发生异常，无法连接服务器"})}throw new Error},credentials:"include"});var Me,ze,je,Be,He,qe;Ve.interceptors.request.use(((e,t)=>{let a=r({},t.headers);return window.location.pathname.startsWith("/chart/")||(a["X-CSRF-TOKEN"]=localStorage.getItem("csrfToken")||""),{url:e,options:r(r({},t),{headers:a})}})),Ve.interceptors.response.use((e=>{const{status:t,statusText:a}=e;if(200===t)return e.clone().json().then((e=>{if(""===e.err)return e.dat&&"[object Null]"===Object.prototype.toString.call(e.dat.list)&&(e.dat.list=[]),r(r({},e),{success:!0});throw new Re(e.err,e)}));if(401!==t&&452!==t||(location.href="/login"+("/"!=location.pathname?"?redirect="+location.pathname:"")),404===t)return e.clone().json().then((e=>{i.error({message:(null==e?void 0:e.err)||"您的网络发生异常，无法连接服务器"})}));throw new Error}),{global:!1}),(ze=Me||(Me={})).Get="Get",ze.Post="Post",ze.Put="Put",ze.Delete="Delete",(Be=je||(je={}))[Be.Add=0]="Add",Be[Be.Delete=1]="Delete",(qe=He||(He={}))[qe.Favorite=0]="Favorite",qe[qe.Common=1]="Common";const Ue=((e,t)=>{switch(t){case"local":return e.LOCAL;case"dev":return e.DEV;case"development":return e.TEST;case"production":return e.PRODUCTION;default:return e.TEST||e.DEV}})({LOCAL:"http://apim.v2.intra.xiaojukeji.com/mock",DEV:"http://10.86.76.13:8085",TEST:"http://localhost:8765",PRODUCTION:""},"production"),Ke=function(e,t){return Ve(`${Ue}/api/n9e/auth/login`,{method:Me.Post,data:{username:e,password:t}})},Ye=function(e,t){return Ve(`${Ue}/api/n9e/self/password`,{method:Me.Put,data:{oldpass:e,newpass:t}})},Je=function(){return Ve(`${Ue}/api/n9e/csrf`,{method:Me.Get})},{SubMenu:We}=f,Qe=()=>{let{profile:e}=c((e=>e.account));const t=m(),a=u(),[n,l]=d.useState(!1);return"/login"===a.pathname||a.pathname.startsWith("/chart/")?null:d.createElement("div",{style:{display:"flex",flexDirection:"column"}},d.createElement("div",{className:"home "+(n?"collapse":"")},d.createElement("div",{className:"name",onClick:()=>t.push("/overview"),key:"overview"},d.createElement("img",{src:"/logo.png",alt:"",className:"logo"}),d.createElement("strong",{style:{lineHeight:"32px"}},"滴滴夜莺")),d.createElement(p,{type:"primary",onClick:()=>{l(!n)},className:"collapseBtn"},d.createElement(n?h:E))),d.createElement(f,{theme:"dark",inlineCollapsed:n,onClick:({key:e})=>{"logout"===e&&Ve(`${Ue}/api/n9e/auth/logout`,{method:Me.Get}).then((e=>{t.push("/login")})),e.startsWith("/")&&t.push(e)},mode:"vertical"},d.createElement(We,{key:"1",icon:d.createElement(g,null),title:"监控看图"},d.createElement(f.Item,{key:"/metric/explorer"},"即时看图"),d.createElement(f.Item,{key:"/dashboard"},"监控大盘"),d.createElement(f.Item,{key:"/indicator"},"指标释义")),d.createElement(f.Item,{key:"/resource",icon:d.createElement(y,null)},"资源管理"),d.createElement(We,{icon:d.createElement(v,null),title:"策略配置"},d.createElement(f.Item,{key:"/strategy"},"告警策略"),d.createElement(f.Item,{key:"/shield"},"告警屏蔽")),d.createElement(f.Item,{key:"/event",icon:d.createElement(k,null)},"事件管理"),d.createElement(f.Item,{className:"holder"}),d.createElement(We,{icon:d.createElement(b,null),title:"用户管理"},d.createElement(f.Item,{key:"/manage/user"},"用户"),d.createElement(f.Item,{key:"/manage/group"},"团队")),d.createElement(We,{title:d.createElement("span",{className:"avator"},d.createElement("img",{src:e.portrait,alt:""}),n?null:d.createElement("span",null,e.nickname||e.username))},d.createElement(f.Item,{key:"/account/profile/info"},"个人信息"),d.createElement(f.Item,{key:"logout"},"退出"))))};let Xe;const Ze={},et=function(e,t){if(!t)return e();if(void 0===Xe){const e=document.createElement("link").relList;Xe=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in Ze)return;Ze[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":Xe,t||(n.as="script",n.crossOrigin=""),n.href=e,document.head.appendChild(n),t?new Promise(((e,t)=>{n.addEventListener("load",e),n.addEventListener("error",t)})):void 0}))).then((()=>e()))},tt=e=>class extends d.Component{render(){return d.createElement(d.Suspense,{fallback:d.createElement("div",{style:{width:"100%",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"}},d.createElement(N,null))},d.createElement(e,null))}};function at(){const[e]=_.useForm(),t=m(),a=u(),n=a.search&&new URLSearchParams(a.search).get("redirect"),l=C(),r=async()=>{try{await e.validateFields(),s()}catch(t){console.log("输入有误")}},s=async()=>{let{username:a,password:r}=e.getFieldsValue();await l({type:"account/login",username:a,password:r})||t.push(n||"/overview")};return d.createElement("div",{className:"login-warp"},d.createElement("div",{className:"banner"},d.createElement("div",{className:"banner-bg"},d.createElement("img",{src:"/logo.png",className:"logo"}),d.createElement("div",{className:"name"},"滴滴夜莺"))),d.createElement("div",{className:"login-panel"},d.createElement("div",{className:"login-main"},d.createElement("div",{className:"login-title"},"Nightingale"),d.createElement(_,{form:e,layout:"vertical",requiredMark:!0},d.createElement(_.Item,{required:!0,name:"username",rules:[{required:!0,message:"请输入用户名"}]},d.createElement(x,{placeholder:"请输入用户名",prefix:d.createElement(b,{className:"site-form-item-icon"})})),d.createElement(_.Item,{required:!0,name:"password",rules:[{required:!0,message:"请输入密码"}]},d.createElement(x,{type:"password",placeholder:"请输入密码",onPressEnter:r,prefix:d.createElement(w,{className:"site-form-item-icon"})})),d.createElement(_.Item,null,d.createElement(p,{type:"primary",onClick:r},"登录"))))))}const nt=e=>{var{onSearch:t}=e,a=s(e,["onSearch"]);const[n,l]=d.useState("");return d.createElement(x,r({prefix:d.createElement(P,null),value:n,onChange:e=>{l(e.target.value),""===e.target.value&&t&&t("")},onPressEnter:e=>{t&&t(n)}},a))};class lt extends d.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return console.log(e,"error"),{hasError:!0}}componentDidCatch(e,t){console.log(e,t)}render(){return this.state.hasError?null:this.props.children}}const rt=150,st=["pink","red","yellow","orange","cyan","green","blue","purple","geekblue","magenta","volcano","gold","lime"],ot=["red","orange","blue"],it=[{num:5,unit:"Minutes",shortUnit:"m"},{num:15,unit:"Minutes",shortUnit:"m"},{num:30,unit:"Minutes",shortUnit:"m"},{num:1,unit:"Hour",shortUnit:"h"},{num:2,unit:"Hours",shortUnit:"h"},{num:6,unit:"Hours",shortUnit:"h"},{num:12,unit:"Hours",shortUnit:"h"},{num:1,unit:"Day",shortUnit:"d"},{num:1,unit:"Week",shortUnit:"w"},{num:1,unit:"Month",shortUnit:"M"}],ct=function(e,t="download.txt"){const a=document.createElement("a"),n=new Blob([Array.isArray(e)?e.join("\r\n"):e],{type:"text/plain"});a.href=URL.createObjectURL(n),a.download=t,document.body.appendChild(a),a.click()},mt=e=>{const t=document.createElement("textarea");t.style.border="0",t.style.padding="0",t.style.margin="0",t.style.position="absolute",t.style.left="-9999px";const a=window.pageYOffset||document.documentElement.scrollTop;let n;t.style.top=`${a}px`,t.setAttribute("readonly",""),t.value=e,document.body.appendChild(t),t.select();try{n=document.execCommand("copy"),e.includes("\n")?S.success(`复制${e.split("\n").length}条数据到剪贴板`):S.success("复制到剪贴板")}catch(l){S.error("复制失败"),n=!1}return n&&document.body.removeChild(t),n};var ut=d.forwardRef((function(e,t){const[a,n]=d.useState(!1),l=t=>{console.log("=====e",t),e.noModal||n(!0)};d.useEffect((()=>{void 0!==e.isClose&&e.isClose&&(n(!1),e.setParentClose&&e.setParentClose(!1))}));const s=()=>{n(!1),e.handleCancel&&e.handleCancel()};return d.useImperativeHandle(t,(()=>({showModal:l,handleCancel:s}))),d.createElement(d.Fragment,null,e.customizeButton?d.createElement("span",{onClick:l},e.customizeButton):e.menuButton?d.createElement("li",{className:"ant-dropdown-menu-item",onClick:l},e.menuButton):d.createElement(p,r({onClick:l,type:"primary"},e.buttonProps),e.buttonName),d.createElement($,r({destroyOnClose:!0,maskClosable:!1,title:e.modalName,visible:a,zIndex:1001,onOk:e.onOk||(()=>{if(e.handleOk){const a=e.handleOk();!(t=a)||"object"!=typeof t&&"function"!=typeof t||"function"!=typeof t.then?n(!1):a.then((e=>{e&&n(!1)}))}var t}),onCancel:s},e.modalProps),e.children))}));const dt={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},pt=({children:e,setFields:t,form:a,layout:n="vertical"})=>(d.useEffect((()=>{t&&t(a)}),[]),d.createElement(_,r(r({},dt),{preserve:!1,form:a,layout:n}),e));function ht(e){const[t]=_.useForm(),a=C(),[n,l]=d.useState(!1);return d.createElement(ut,{noModal:e.noModal,menuButton:e.menuButton,modalName:e.modalName,handleOk:()=>t.validateFields().then((t=>{l(!0);const n=e.beforePromiseOk?e.beforePromiseOk(t):t;return e.handlePromiseOk(n).then((n=>(console.log(n),n.success&&e.afterPromiseOk&&e.afterPromiseOk(n.dat,t,a),l(!1),n.success))).catch((e=>{l(!1)}))})).catch((e=>{console.warn(e),l(!1)})),modalProps:r({confirmLoading:n},e.modalProps),customizeButton:e.customizeButton},d.createElement(pt,{setFields:e.setFields,form:t,layout:e.formLayout},"function"!=typeof e.children?e.children:e.children(t)))}const Et=function(e){return Ve(`${Ue}/api/n9e/classpaths`,{method:Me.Post,data:e})},ft=function(e,t=1){return Ve(`${Ue}/api/n9e/classpaths`,{method:Me.Get,params:{query:e,limit:15,p:t}})},gt=function(e){return Ve(`${Ue}/api/n9e/classpath/${e}/favorites`,{method:Me.Post,data:{id:e}})},yt=function(e){return Ve(`${Ue}/api/n9e/classpath/${e}/favorites`,{method:Me.Delete,data:{id:e}})},vt=function(e){return Ve(`${Ue}/api/n9e/classpath/${e}`,{method:Me.Delete})},kt=function(e){return Ve(`${Ue}/api/n9e/classpath/${e.id}`,{method:Me.Put,data:e})},bt=function(e){return Ve(`${Ue}/api/n9e/classpath/${e.id}/resources`,{method:Me.Get,params:r(r({},e),{id:void 0})})},Nt=function(e){return Ve(`${Ue}/api/n9e/resources`,{method:Me.Get,params:{qres:e}})},_t=function(e,t){return Ve(`${Ue}/api/n9e/classpath/${e}/resources`,{method:Me.Delete,data:t})},Ct=function(e){return Ve(`${Ue}/api/n9e/classpath/${e.id}/resources`,{method:Me.Post,data:e.data})},xt=function(e){return Ve(`${Ue}/api/n9e/resource/${e}`,{method:Me.Get})},wt=function(e){return Ve(`${Ue}/api/n9e/collect-rules`,{method:Me.Post,data:e})},Pt=function(e){return Ve(`${Ue}/api/n9e/v2/collect-rules`,{method:Me.Post,data:e})},St=function(e){return Ve(`${Ue}/api/n9e/collect-rule/${e.id}`,{method:Me.Put,data:e})},$t=function(e){return function(t){return Ve(`${Ue}/api/n9e/classpath/${t.id}/collect-rules`,{method:Me.Get,params:r(r({},t),{type:e})})}},It=function(e){return Ve(`${Ue}/api/n9e/collect-rules`,{method:Me.Delete,data:{ids:e}})};function Ot(e){var{payload:t,defaultVisible:a=!1,renderContent:n,renderTrigger:l,renderFooter:o,onConfirm:i,onMounted:c,beforeClose:m}=e,u=s(e,["payload","defaultVisible","renderContent","renderTrigger","renderFooter","onConfirm","onMounted","beforeClose"]);const h=d.useRef(),[E,f]=d.useState(!1),[g,y]=d.useState(!1),[v,k]=d.useState({});d.useEffect((()=>{if(!E)return;const e=null==c?void 0:c(_);return()=>{null==e||e()}}),[E]);const b=()=>{f(!1)},N=()=>{m?m(_).then((()=>{b()})):b()},_={payload:t,ref:h,open:()=>{f(!0)},close:b,innerContext:v,setInnerContext:k},C=d.createElement("div",{style:{textAlign:"left"}},d.createElement(p,{style:{marginRight:8},type:"primary",loading:g,onClick:()=>{y(!0),i(_).then((()=>{b()})).finally((()=>{y(!1)}))}},"保存"),d.createElement(p,{onClick:N},"取消"));return d.createElement(d.Fragment,null,l(_),d.createElement(I,r({footer:o?o(_):C,className:"App",visible:E,onClose:N,destroyOnClose:!0},u),d.createElement("div",null,n(_))))}var Dt=d.forwardRef((function(e,t){var{fetchHandle:a,fetchParams:n={},needPagination:l=!0,pageSize:o,feQueryKey:i="query",feFixedKey:c="id",feQueryParams:m=[],fePaging:u=!1,autoFetch:p=!0,initFetch:h=!1,onFetchList:E,paginationProps:f}=e,g=s(e,["fetchHandle","fetchParams","needPagination","pageSize","feQueryKey","feFixedKey","feQueryParams","fePaging","autoFetch","initFetch","onFetchList","paginationProps"]);const[y,v]=d.useState([]),[k,b]=d.useState([]),[N,_]=d.useState([]),[C,x]=d.useState(!1),[w,P]=d.useState(1),[S,$]=d.useState(!1),[I,D]=d.useState(0),[F,G]=d.useState((()=>o||15)),[T,L]=d.useState({});d.useEffect((()=>{p&&(R(),x(!0))}),[]),d.useEffect((()=>{!p&&h&&(R(),x(!0))}),[h]),d.useEffect((()=>{if(C)if(u){const e=k.slice((w-1)*F,w*F);_(e),E&&E(e)}else R()}),[w,F]),d.useEffect((()=>{u?(T[c]&&T[c]===n[c]?(A(y),P(1)):1===w?C&&R():P(1),L(n)):1===w?C&&R():P(1)}),[JSON.stringify(n)]);const R=async()=>{$(!0);const{success:e,dat:t}=await a(r(r({},n),{p:w,limit:F}));var l;e&&(!u&&(l=t,Array.isArray(l.list))?(v(t.list||[]),D(t.total),E&&E(t.list||[])):(v(t||[]),A(t||[]))),$(!1)},A=e=>{if(Array.isArray(e)){const t=n[i]||"",a=e.filter((e=>{let a=!1;return""!==t&&Array.isArray(m)&&0!==m.length?(m.forEach((n=>{const l=V(n,e);"string"==typeof l&&(a=a||-1!==l.indexOf(t))})),a):(a=!0,a)}));b(a),D(a.length);const l=a.slice((w-1)*F,w*F);_(l),E&&E(l)}else b([]),D(0),_([]),E&&E([])},V=(e,t)=>{const a=()=>{const a=e.indexOf("."),n=e.slice(0,a);return t[n]?V(e.slice(a+1,e.length),t[n]):""},n=()=>{let a=e.indexOf("[");if(a<=0)return"";let n=e.indexOf("]");const l=e.slice(0,a),r=t[l];if(Array.isArray(r)&&r.length){if(-1!==n){const a=e.match(/\[(\w+)\]/);if(a.length<2)return"";{const l=a[1];return r[l]?n===e.length-1?r[l]:V(e.slice(n+1,e.length),t[l]):""}}return""}return""};return-1!==e.indexOf(".")&&-1!==e.indexOf("[")?e.indexOf(".")<e.indexOf("[")?a():n():-1!==e.indexOf(".")?a():-1!==e.indexOf("[")?n():t[e]||""},M=()=>{R()};return d.useImperativeHandle(t,(()=>({refreshList:M}))),d.createElement(O,r({dataSource:u?N:y,pagination:r({showTotal:e=>`Total records ${e}`,current:w,pageSize:F,onChange:P,total:I,showSizeChanger:!0,onShowSizeChange:(e,t)=>{G(t),P(1)}},f),loading:S},g))}));const{confirm:Ft}=$,{TextArea:Gt}=x,Tt=(e,t,a,n)=>({customizeButton:d.createElement("div",null,"import"===e?"导入规则":"导出规则"),modalName:"import"===e?"导入规则":"导出规则",handlePromiseOk:t=>{if("import"!==e)return Promise.resolve();try{const e=JSON.parse((null==t?void 0:t.data)||"[]");return Pt(e.map((e=>r(r({},e),{classpath_id:n}))))}catch(a){return Promise.resolve()}},afterPromiseOk:(t,n)=>{"import"===e&&a&&a()},setFields:a=>{"export"===e&&a.setFieldsValue({data:t||""})},formLayout:"horizontal",children:d.createElement(d.Fragment,null,d.createElement("p",{style:{color:"#999"}},"export"===e&&d.createElement("a",{onClick:()=>{ct(t||[""],"Download.json")}},"Download.json")),d.createElement(_.Item,{name:"data",key:"data",wrapperCol:{span:24},rules:[{required:!0,message:"请输出导入信息",validateTrigger:"trigger"}]},d.createElement(Gt,{rows:4})))}),Lt=function(e){return Ve(`${Ue}/api/n9e/tag-keys`,{method:Me.Post,data:e})},Rt=function(e){return Ve(`${Ue}/api/n9e/tag-values`,{method:Me.Post,data:e})},At=function(e){return Ve(`${Ue}/api/n9e/dashboards`,{method:Me.Get,params:e})},Vt=function(e){return Ve(`${Ue}/api/n9e/dashboards/import`,{method:Me.Post,data:e})},Mt=function(e){return Ve(`${Ue}/api/n9e/dashboard/${e}`,{method:Me.Get})},zt=function(e,t){return Ve(`${Ue}/api/n9e/dashboard/${e}`,{method:Me.Put,data:t})},jt=function(e,t){return Ve(`${Ue}/api/n9e/dashboard/${e}/chart-groups`,{method:Me.Post,data:t})},Bt=function(e){return Ve(`${Ue}/api/n9e/dashboard/${e}/chart-groups`,{method:Me.Get})},Ht=function(e){return Ve(`${Ue}/api/n9e/chart-group/${e}`,{method:Me.Delete})},qt=function(e){return Ve(`${Ue}/api/n9e/chart-groups`,{method:Me.Put,data:e})},Ut=function(e,t){return Ve(`${Ue}/api/n9e/chart-group/${e}/charts`,{method:Me.Post,data:t})},Kt=function(e,t){return Ve(`${Ue}/api/n9e/chart/${e}`,{method:Me.Put,data:t})},Yt=function(e){const t=e.map((e=>r(r({},e),{configs:JSON.stringify(e.configs)})));return Ve(`${Ue}/api/n9e/charts/configs`,{method:Me.Put,data:t})},Jt=function(e){return Ve(`${Ue}/api/n9e/chart-group/${e}/charts`,{method:Me.Get})},Wt=function(e){return Ve(`${Ue}/api/n9e/chart/${e}`,{method:Me.Delete})},Qt=function(e){return Ve(`${Ue}/api/n9e/check-promql`,{method:Me.Get,params:{promql:e}})},Xt=function(e){return Ve(`${Ue}/api/n9e/tpl/list?tpl_type=${e}`,{method:Me.Get})},Zt=function(e,t){return Ve(`${Ue}/api/n9e/tpl/content?tpl_type=${e}&tpl_name=${t}`,{method:Me.Get})},{confirm:ea}=$;var ta=d.forwardRef((function({activeKey:e,currentKey:t,createModalProps:a,searchPlaceHolder:n="资源信息, 或标签",fetchHandle:l,columns:s},o){const{currentGroup:i,prefix:m}=c((e=>e.resource)),[u,h]=d.useState([]),[E,f]=d.useState([]),[g,y]=d.useState(""),[v,k]=d.useState(!1),b=d.useRef(null);d.useEffect((()=>{e===t&&!v&&(null==i?void 0:i.id)&&k(!0)}),[e,t,v,i]),d.useEffect((()=>{N()}),[m]),d.useEffect((()=>{h([])}),[null==i?void 0:i.id]);const N=()=>{b.current.refreshList()};d.useImperativeHandle(o,(()=>({refreshList:N})));const[_,C]=d.useState([]);d.useEffect((()=>{ft().then((e=>{C(e.dat.list)}))}),[u]);const x=d.useCallback((()=>({fetchParams:{id:(null==i?void 0:i.id)||"",query:g,prefix:m},fetchHandle:l,autoFetch:!1,initFetch:v,feQueryParams:["name","note","data.port","data.param"],columns:s,rowKey:"id",pageSize:10,fePaging:!0,rowSelection:{selectedRowKeys:u,selectedRows:E,onChange:(e,t)=>{h(e),f(t)}}})),[null==i?void 0:i.id,v,u,g,m]),w=d.useMemo((()=>d.createElement("ul",{className:"ant-dropdown-menu"},d.createElement("li",{className:"ant-dropdown-menu-item"},d.createElement(ht,r({},Tt("import",JSON.stringify(E,null,2),N,null==i?void 0:i.id)))),d.createElement("li",{className:"ant-dropdown-menu-item"},u.length?d.createElement(ht,r({},Tt("export",JSON.stringify(E,null,2)))):d.createElement("div",{onClick:()=>{S.warning("未选择任何规则")}},"导出规则")),d.createElement("li",{className:"ant-dropdown-menu-item"},u.length?d.createElement(ht,r({},on(E,_))):d.createElement("div",{onClick:()=>{S.warning("未选择任何规则")}},"克隆到其他资源分组")),d.createElement("li",{className:"ant-dropdown-menu-item"},d.createElement("span",{onClick:()=>{u.length?ea({title:"是否批量删除规则?",onOk:()=>{It(u).then((()=>{S.success("删除成功"),N()}))},onCancel(){}}):S.warning("未选择任何规则")}},"删除")))),[u]);return d.createElement("div",null,d.createElement("div",{className:"table-search-area"},d.createElement(nt,{style:{width:"400px"},placeholder:n,onSearch:e=>{y(e)}}),d.createElement("div",{className:"table-search-area-right"},a?d.createElement(ht,r({},a)):null,d.createElement("div",{className:"table-more-options"},d.createElement(F,{overlay:w,trigger:["click"]},d.createElement(p,{onClick:e=>e.stopPropagation(),style:{marginLeft:8}},"更多操作",d.createElement(G,{style:{marginLeft:2}})))))),d.createElement(Dt,r({ref:b},x())))}));var aa,na,la,ra,sa,oa;(na=aa||(aa={}))[na.Need=1]="Need",na[na.UnNeed=0]="UnNeed",(ra=la||(la={})).CmdLine="cmdline",ra.Name="name",(oa=sa||(sa={})).TCP="tcp",oa.UDP="udp";const ia=({value:e,editType:t,selectProps:a,validator:n,onChange:l})=>{const[s,o]=d.useState(!1),[i,c]=d.useState(e),[m,u]=d.useState(e);d.useEffect((()=>{c(e),u(e)}),[e]);const h=e=>{let t=!0;!n||(t=n(e)||!1,t)?u(e):S.error(`"${e}"不符合输入规范（格式为key=value）`)},E=()=>{u(i),o(!1)},f=()=>{o(!1),l&&l(m),c(m)};return d.createElement(d.Fragment,null,s?(console.log(m),d.createElement(d.Fragment,null,"input"===t?d.createElement(x,{value:m,onChange:e=>{h(e.target.value)}}):d.createElement(V,r({onChange:h,value:m},a)),d.createElement(p,{style:{margin:"0 8px"},size:"small",onClick:E},"取消"),d.createElement(p,{size:"small",type:"primary",onClick:f},"保存"))):(()=>{let e;return Array.isArray(m)&&"select"===t&&(console.log(m,null==a?void 0:a.options,"renderComon"),e=(null==a?void 0:a.options)?null==a?void 0:a.options.filter((e=>m.includes(e.value))).map(((e,t)=>d.createElement(R,{key:t,color:"blue"},e.label))):m.map((e=>d.createElement(R,{key:e,color:"blue"},e)))),d.createElement("div",{style:{display:"flex",alignItems:"center"},className:"hoverInput"},d.createElement("div",{style:{minHeight:32,marginRight:10}},"select"===t?e:m),d.createElement(A,{onClick:()=>{o(!0)}}))})())},{confirm:ca}=$,ma=()=>{var e,t,a;const{group:{common:n},resourceData:{resourceDetail:l,resourceDetailLoading:r}}=c((e=>e.resource)),s=C();return d.createElement("div",{className:"detail-content"},d.createElement(N,{spinning:r},d.createElement(M,{title:"资源详情"},d.createElement(z,{align:"middle",className:"row-style"},d.createElement(j,{span:2,style:{textAlign:"right"}},"资源名称:"),d.createElement(j,{offset:1},null!=(e=null==l?void 0:l.alias)?e:"")),d.createElement(z,{className:"row-style"},d.createElement(j,{span:2,style:{textAlign:"right"}},"资源标识:"),d.createElement(j,{offset:1},null!=(t=null==l?void 0:l.ident)?t:"")),d.createElement(z,{align:"middle",className:"row-style"},d.createElement(j,{span:2,style:{textAlign:"right"}},"标签:"),d.createElement(j,{offset:1},d.createElement(ia,{value:""==(null==l?void 0:l.tags)?[]:null==l?void 0:l.tags.split(" "),editType:"select",onChange:async e=>{if(null==l?void 0:l.id){const{success:a}=await(t={ids:[null==l?void 0:l.id],tags:e.join(" ")},Ve(`${Ue}/api/n9e/resources/tags`,{method:Me.Put,data:t}));a&&s({type:"resource/getResourceItem",id:(null==l?void 0:l.id)||""})}var t},validator:e=>{let t=e[e.length-1];return!(t&&!/\w+=\w+/.test(t))},selectProps:{mode:"tags",allowClear:!0,placeholder:"格式为key=value回车分隔"}}))),d.createElement(z,{align:"middle",className:"row-style"},d.createElement(j,{span:2,style:{textAlign:"right"}},"资源分组:"),d.createElement(j,{offset:1},d.createElement(ia,{value:(null==l?void 0:l.classpath_ids)||[],editType:"select",onChange:async e=>{if(null==l?void 0:l.id){const{success:a}=await(t={res_idents:(null==l?void 0:l.ident)?[null==l?void 0:l.ident]:[],classpath_ids:e},Ve(`${Ue}/api/n9e/resources/classpaths`,{method:Me.Put,data:t}));a&&s({type:"resource/getResourceItem",id:(null==l?void 0:l.id)||""})}var t},selectProps:{mode:"multiple",allowClear:!0,placeholder:"请选择所属资源分组",options:n.map((e=>({value:e.id,label:e.path,children:d.createElement(R,{color:"blue"},e.path)})))}}))),d.createElement(z,{align:"middle",className:"row-style"},d.createElement(j,{span:2,style:{textAlign:"right"}},"备注:"),d.createElement(j,{offset:1},d.createElement(ia,{value:null!=(a=null==l?void 0:l.note)?a:"",editType:"input",onChange:async e=>{if(null==l?void 0:l.id){const{success:a}=await(t={ids:[null==l?void 0:l.id],note:e},Ve(`${Ue}/api/n9e/resources/note`,{method:Me.Put,data:t}));a&&s({type:"resource/getResourceItem",id:(null==l?void 0:l.id)||""})}var t}}))),d.createElement(z,{align:"middle",className:"row-style"},d.createElement(j,{span:2,style:{textAlign:"right"}},"维护时间:"),d.createElement(j,{offset:1},(()=>{const e=(null==l?void 0:l.mute_btime)||0,t=(null==l?void 0:l.mute_etime)||0;return 0===e&&0===t?d.createElement("div",null,"无"):d.createElement(d.Fragment,null,B(1e3*e).format("YYYY-MM-DD HH:mm:ss")," - ",B(1e3*t).format("YYYY-MM-DD HH:mm:ss"))})()))),d.createElement(M,{title:"彻底删除资源",style:{marginTop:40}},d.createElement("p",null,"两种情况会有彻底删除资源的需求："),d.createElement("p",null,"1. 资源对应的设备已经下线了，永远都不会有新的监控数据上报了"),d.createElement("p",null,"2. 资源的ident(唯一标识)发生变化，老的ident需要手工清理掉"),d.createElement(p,{onClick:()=>{if(l){const{id:e,alias:t}=l;ca({zIndex:2001,title:`是否确认永久删除资源${t}?`,icon:d.createElement(D,null),onOk:()=>{(function(e){return Ve(`${Ue}/api/n9e/resource/${e}`,{method:Me.Delete})})(e).then((()=>{window.location.reload()}))},onCancel(){}})}},className:"clear-button",style:{float:"right"}},"彻底删除资源"))))},ua=function(e){return Ve(`${Ue}/api/n9e/tag-pairs`,{method:Me.Post,data:e})},da=function(e){return Ve(`${Ue}/api/n9e/tag-metrics`,{method:Me.Post,data:e})},pa=function(e){return Ve(`${Ue}/api/n9e/charts/tmps`,{method:Me.Post,data:e})},{Option:ha}=V;var Ea=d.forwardRef((({onChange:e,idents:t},a)=>{const[n,l]=d.useState([]),[r,s]=d.useState([]),[o,i]=d.useState(""),[c,m]=d.useState([]);d.useEffect((()=>{u()}),[]),d.useEffect((()=>{u()}),[o,JSON.stringify(t)]);const u=()=>{da({limit:150,metric:o,idents:t}).then((e=>{e.dat.metrics&&(s(e.dat.metrics),m(e.dat.metrics.concat(c)))}))},p=t=>{l(t);let a=t.map((e=>c.find((t=>t.name===e))));e(a)},h=H.debounce((e=>{i(e)}),500),E=()=>{p([])};return d.useImperativeHandle(a,(()=>({reset:E}))),d.createElement(d.Fragment,null,d.createElement(V,{mode:"multiple",style:{width:"100%"},placeholder:"请输入监控指标",value:n,onChange:p,onSearch:h,onDeselect:()=>{n.length<=1&&i("")},filterOption:!1,dropdownClassName:"overflow-586"},r.map(((e,t)=>d.createElement(ha,{key:t,value:e.name},e.name," ",e.description)))))}));const{Option:fa}=V;var ga,ya,va=d.forwardRef(((e,t)=>{const[a,n]=d.useState([]),[l,r]=d.useState([]);d.useEffect((()=>{s(void 0)}),[e.metrics]);const s=t=>{let a=e.metrics.map((e=>({metric:e})));ua({limit:200,params:a,tags:t}).then((e=>{e.dat.tags&&n(e.dat.tags)}))},o=t=>{r(t),e.onChange(t);let a=t.map((e=>{let[t,a]=e.split("=");return{key:t,value:a}}));s(a)},i=()=>{o([])};return d.useImperativeHandle(t,(()=>({reset:i}))),d.createElement(V,{mode:"multiple",style:{width:"100%"},value:l,placeholder:"请选择标签",onChange:o},a.map(((e,t)=>d.createElement(fa,{key:t,value:e},e))))}));function ka(e){const{tagInfo:t,onOk:a}=e,{tagKey:n,tagValue:l,selectValue:s}=t,[o,i]=d.useState(""),[c,m]=d.useState(!1),[u,h]=d.useState([]),[E,f]=d.useState(0),g={onChange:(e,t)=>{h(t.map((e=>e.name)))}},y=e=>{i(e)},v=()=>{let e=u.map((e=>({key:n,value:e})));a({tagKey:n,data:e}),m(!1),f(e.length)};return d.createElement(q,{content:(k=l,d.createElement(d.Fragment,null,d.createElement(nt,{placeholder:"请输入搜索关键词",allowClear:!0,onSearch:y}),d.createElement(O,{className:"tag-table",style:{width:"300px"},rowSelection:r({type:"checkbox"},g),pagination:{pageSize:5,simple:!0},columns:[{title:"Name",dataIndex:"name"}],rowKey:"name",dataSource:k.filter((e=>e.includes(o))).map((e=>({name:e})))}),d.createElement(p,{onClick:v,size:"small",type:"primary",className:"tag-apply"},"Apply"))),title:n,trigger:"click",visible:c,onVisibleChange:e=>{m(e)}},d.createElement(R,{onClick:()=>m(!0)},n," ",d.createElement("span",{className:"tag-num"},E>0?E:"")," ",d.createElement(G,null)));var k}function ba(e){let t={};return e.map((e=>e.split("="))).forEach((([e,a])=>{t[e]?t[e].tagValue.push(a):t[e]={tagKey:e,tagValue:[a],selectValue:[],filter:""}})),Object.keys(t).map((e=>t[e]))}function Na(e){const{options:t,onChange:a}=e,{metric:n,tags:l,start:r,end:s,limit:o,idents:i}=t,[c,m]=d.useState([]),[u,p]=d.useState([]);d.useEffect((()=>{ua({params:Array.isArray(n)?n.map((e=>({metric:e,idents:i}))):[{metric:n,idents:i}],tags:l,limit:o,start:r,end:s}).then((e=>{e.dat&&e.dat.tags&&m(ba(e.dat.tags))}))}),[o,n,l]);const h=e=>{let t=u.filter((t=>t.key!==e.tagKey)).concat(e.data);p(t),a(t)};return d.createElement(d.Fragment,null,Object.keys(c).map(((e,t)=>d.createElement(ka,{key:t,tagInfo:c[t],onOk:h}))))}function _a(e){return!!(e&&e.start&&e.end)}(ya=ga||(ga={})).Line="line",ya.Pie="pie",ya.Bar="bar";const Ca=(e,t)=>void 0===e?"":B(e).format(t);function xa(e){const{open:t,onChange:a}=e,[n,l]=d.useState(),[r,s]=d.useState(),[o,i]=d.useState(),c=(e,t)=>B(e).isBefore(t,"date"),m=(e,t,a)=>{return!(!t||!a)&&(n=t,B(e).isAfter(n,"date")&&c(e,a));var n};return d.createElement(d.Fragment,null,t&&d.createElement(U,{base:B(),startDay:n,endDay:r,showMonthCnt:2,customDayClass:e=>n&&!r&&o&&m(e,n,o)?"calendar__day--range":"",onChange:e=>{let t,o;t=n,o=r,n?r?(t=e,o=void 0):c(e,n)?t=e:o=e:t=e,l(t),s(o),a({startDate:t,endDate:o})},onMouseOver:e=>{i(e)},disableDay:e=>B(e).isAfter(B(),"date")}))}const{Option:wa}=V;function Pa(e){const{onChange:t,initValue:a}=e,[n,l]=d.useState(""),[r,s]=d.useState(!1),[o,i]=d.useState(!1);return d.useEffect((()=>{a?(e=>{if(_a(e)){const{start:t,end:a}=e;l(`${B(1e3*t).format("YY-MM-DD")}  --  ${B(1e3*a).format("YY-MM-DD")}`)}else{const t=it.findIndex((t=>t.num===(null==e?void 0:e.num)&&t.unit===e.unit));l(t)}})(a):(l(3),t(it[3]))}),[]),d.useEffect((()=>{function e(e){console.log("hideTheCalendar"),e.preventDefault(),[].findIndex.call(e.path,(e=>"calendar"===e.className))<0&&s(!1)}return r&&document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0)}}),[r]),d.createElement("div",{className:o?"range-picker calendar":"range-picker"},d.createElement("span",{className:o?"tag from-calendar show":"tag from-calendar"},"5m"),d.createElement(V,{className:"select",value:n,onChange:e=>{e>it.length-1?s(!0):(l(e),t(it[e]),i(!1))},dropdownStyle:{marginLeft:"60px"}},it.map(((e,t)=>d.createElement(wa,{key:t,value:t}," ",d.createElement("span",{className:"tag"},e.num,e.shortUnit),"Past ",e.num," ",e.unit))),d.createElement(wa,{key:it.length,value:it.length}," ",d.createElement("span",{className:"tag"},d.createElement("b",null,d.createElement(K,null))),"Select from calendar"," ")),d.createElement(xa,{open:r,onChange:e=>{e.startDate&&e.endDate&&(s(!1),l(`${Ca(e.startDate,"YY-MM-DD")}  --  ${Ca(e.endDate,"YY-MM-DD")}`),t({start:B(e.startDate).unix(),end:B(e.endDate).unix()}))}}))}function Sa(e){const{onChange:t,showLabel:a}=e,[n,l]=d.useState(!0);return d.createElement("div",{className:"desc-sort"},a&&(n?"降序":"升序"),d.createElement("div",{className:"desc-sort-icon",onClick:()=>{l(!n),t(!n)}},d.createElement(Y,{style:{color:!1===n?"blue":""}}),d.createElement(J,{style:{color:!0===n?"blue":"",marginTop:"-0.3em"}})))}function $a(e){const{options:t,barControl:a,rightBar:n,title:l}=e,[s,o]=d.useState(!1),i=d.useRef(null),{metric:c,description:m="",tags:u,range:h,limit:E,idents:f,classpath_id:g,classpath_prefix:y,prome_ql:v,yplotline:k,xplotline:b}=t,[N,_]=d.useState([]),[C,x]=d.useState(!1),[w,P]=d.useState("desc"),[S,$]=d.useState("origin"),[I,O]=d.useState(null),{start:D,end:F}=(e=>{let t=e||h;if(t){if(_a(t)){const{start:e,end:a}=t;return{start:e,end:a}}return(e=>{const{num:t,shortUnit:a}=e;let n=B().unix();return{start:B().subtract(t,a).unix(),end:n}})(t)}return{start:0,end:0}})(h),G=(e=[])=>{let t=e;u&&u.length>0&&(t=u.concat(t));let a=Array.isArray(c)?c.map((e=>({metric:e,classpath_id:g,classpath_prefix:y?1:0,prome_ql:v,tags:t&&t.length>0?t:void 0,idents:f}))):Array.isArray(v)?v.map((e=>({metric:c,classpath_id:g,classpath_prefix:y?1:0,prome_ql:e,tags:t&&t.length>0?t:void 0,idents:f}))):[{metric:c,classpath_id:g,classpath_prefix:y?1:0,prome_ql:v,tags:t&&t.length>0?t:void 0,idents:f}];var n;(n={params:a,start:D,end:F,limit:E},Ve(`${Ue}/api/n9e/query`,{method:Me.Post,data:n})).then((e=>{const t=[];e.dat.forEach((e=>{t.push({name:e.metric,data:e.values.map((e=>e.v))})}));const a=[];e.dat.forEach((e=>{const{metric:t,values:n,tags:l}=e,r=n.map((e=>({timestamp:1e3*e.t,value:e.v})));a.push({name:(t?`【${t}】`:"")+l,data:r})}));let n=I?{series:a,tooltip:{precision:S,shared:C,sharedSortDirection:w},yAxis:r(r({},I.options.yAxis),{plotLines:k?[{value:k,color:"red"}]:void 0}),xAxis:r(r({},I.options.xAxis),{plotLines:b?[{value:1e3*b,color:"red"}]:void 0})}:{timestamp:"x",xkey:"timestamp",ykey:"value",chart:{renderTo:i.current},yAxis:{plotLines:k?[{value:k,color:"red"}]:void 0},xAxis:{plotLines:b?[{value:1e3*b,color:"red"}]:void 0},series:a,tooltip:{precision:S,shared:C,sharedSortDirection:w}};I?I.update(n):O(new Z(n))}))};d.useEffect((()=>{G(N)}),[t,C,w,S]);const L=d.createElement(d.Fragment,null,d.createElement(T,{title:"tooltip中展示所有曲线的值"},d.createElement(W,{onChange:e=>{x(e.target.checked)}},"Multi")),d.createElement(T,{title:d.createElement(d.Fragment,null,d.createElement("span",null,"SI格式化:"),d.createElement("a",{type:"link",href:"https://en.wikipedia.org/wiki/Metric_prefix#List_of_SI_prefixes",target:"_blank"},"文档"))},d.createElement(W,{onChange:e=>{$(e.target.checked?"short":"origin")}},"Format")),d.createElement(Sa,{onChange:e=>{P(e?"desc":"asc")}}));return d.createElement("div",{className:"chart-wrapper"},(l||n||m||c)&&d.createElement("div",{className:"chart-title"},l?d.createElement("div",{className:"chart-title-label"},l):d.createElement("div",{className:"chart-title-label"},c," ",m),d.createElement("div",{className:"chart-title-right-bar"},n,d.createElement(p,{type:"link",size:"small",onClick:async e=>{e.preventDefault();let{dat:n}=await pa([{configs:JSON.stringify({title:l,options:t,barControl:a})}]);window.open("/chart/"+n)}},d.createElement(Q,null)))),!a&&d.createElement("div",{className:"chart-filter"},d.createElement(X,{className:"refresh",spin:s,onClick:e=>{s||(o(!0),G(N),setTimeout((()=>{o(!1)}),1e3))}}),L,!v&&d.createElement(Na,{options:r(r({},t),{start:D,end:F,idents:f}),onChange:e=>{_(e),G(e)}})),"multiOrSort"===a&&d.createElement("div",{className:"chart-filter"},L),d.createElement("div",{ref:i,className:"chart-content"}))}function Ia({onSelect:e}){const[t,a]=d.useState([]),{currentGroup:n}=c((e=>e.resource)),[l,r]=d.useState("");return d.createElement("div",null,d.createElement("div",{className:"table-search-area"},d.createElement(nt,{style:{width:"400px"},placeholder:"资源信息或标签",onSearch:e=>{r(e)}})),d.createElement(Dt,{columns:[{title:"资源标识",dataIndex:"ident"},{title:"资源名称",dataIndex:"alias"}],rowKey:"ident",fetchParams:{id:(null==n?void 0:n.id)||"",query:l},fetchHandle:bt,rowSelection:{selectedRowKeys:t,onChange:t=>{a(t),e&&e(t)}},paginationProps:{simple:!0},onFetchList:t=>{const n=t.map((e=>e.ident));a(n),e&&e(n)}}))}function Oa(e){const{onClick:t,className:a}=e,[n,l]=d.useState(!1);return d.createElement(p,{className:a||"",loading:n,onClick:e=>{n||(l(!0),t(),setTimeout((()=>{l(!1)}),1e3))},icon:d.createElement(X,{className:"refresh",spin:n})})}const{Option:Da}=V;function Fa({resourceGroupId:e,isIdent:t}){const[a,n]=d.useState([]),l=d.useRef(null),s=d.useRef(null),[o,i]=d.useState(1),[c,m]=d.useState({start:0,end:0}),[u,h]=d.useState([]),[E,f]=d.useState({range:{start:0,end:0},limit:50,metric:"",description:""}),y=(e={},t)=>{let a=t||c;f(r(r(r({},E),e),{range:a}))};return d.createElement("div",{className:"explore"},d.createElement(z,null,d.createElement(j,{className:"left",span:8},t?null:d.createElement("div",{className:"page-title"},d.createElement(g,null),"即时看图"),t?d.createElement(Ia,{onSelect:e=>{n(e)}}):null,d.createElement("div",{className:"panel"},d.createElement("div",{className:"title"},"监控指标"),d.createElement(Ea,{idents:a,onChange:e=>{h(e.reverse())},ref:l})),t?null:d.createElement("div",{className:"panel"},d.createElement("div",{className:"title"},"筛选标签"),d.createElement(va,{metrics:u.map((e=>e.name)),onChange:e=>{let t=e.map((e=>{let[t,a]=e.split("=");return{key:t,value:a}}));y({tags:t})},ref:s})),d.createElement("div",{className:"panel"},d.createElement("div",{className:"title"},"配置"),d.createElement("div",null,"每张图最多展示",d.createElement(V,{className:"echart-line-num",defaultValue:"50",size:"small",onChange:e=>{y({limit:e})}},d.createElement(Da,{value:50},"50"),d.createElement(Da,{value:100},"100"),d.createElement(Da,{value:200},"200"),d.createElement(Da,{value:500},"500")),"条线")),d.createElement(p,{type:"primary",onClick:()=>{l.current.reset(),s.current.reset()},style:{marginTop:"10px"}},"重置"),d.createElement(p,{type:"primary",disabled:0===u.length,onClick:async()=>{let e=u.map(((e,t)=>({options:r(r({},E),{metric:e.name,description:e.description})}))).map((e=>({configs:JSON.stringify(e)}))),{dat:t}=await pa(e);window.open("/chart/"+t)},style:{marginTop:"10px"}},"分享图表")),d.createElement(j,{className:"right",span:16},d.createElement("div",null,d.createElement("div",{className:"header"},d.createElement("div",{className:"header-left"},d.createElement(Pa,{onChange:e=>{m(e),y({},e)}}),d.createElement(Oa,{onClick:()=>{y()},className:"reload-icon"})),d.createElement(ee.Group,{value:o,onChange:e=>{i(e.target.value)}},d.createElement(ee.Button,{value:4},"XS"),d.createElement(ee.Button,{value:3},"S"),d.createElement(ee.Button,{value:2},"M"),d.createElement(ee.Button,{value:1},"L"))),d.createElement("div",{className:"chart-list"},d.createElement(z,{gutter:15},u.length>0?u.map(((e,t)=>d.createElement(j,{key:t,span:24/o},d.createElement($a,{options:r(r({},E),{idents:a.length>0?a:void 0,metric:e.name,description:e.description})})))):d.createElement("h2",{className:"holder"},d.createElement(te,{style:{fontSize:"30px"}}),d.createElement("span",null,"选择监控指标添加图表"))))))))}var Ga=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Fa});const{RangePicker:Ta}=ne,La=[{value:36e5,label:"1小时"},{value:72e5,label:"2小时"},{value:216e5,label:"6小时"},{value:432e5,label:"12小时"},{value:864e5,label:"1天"},{value:1728e5,label:"2天"},{value:6048e5,label:"7天"},{value:12096e5,label:"14天"},{value:2592e6,label:"30天"},{value:7776e6,label:"90天"},{value:6048e9,label:"永久"}],Ra=Date.now(),Aa=({value:e,onChange:t})=>{const[a,n]=d.useState(0),[l,r]=d.useState(0),[s,o]=d.useState(0);d.useEffect((()=>{(null==e?void 0:e.btime)&&(null==e?void 0:e.etime)?(o(1e3*e.etime),r(1e3*e.btime),n(1e3*(e.etime-e.btime))):(r(Ra),o(Ra+La[0].value),n(La[0].value),i(Ra,Ra+La[0].value))}),[null==e?void 0:e.btime,null==e?void 0:e.etime]);const i=(e,a)=>{t&&t({btime:Math.floor(e/1e3),etime:Math.floor(a/1e3)})};return d.createElement("div",null,d.createElement(ee.Group,{value:a,style:{marginBottom:8},onChange:e=>{n(e.target.value),i(Ra,Ra+e.target.value)}},La.map((e=>d.createElement(ee.Button,{key:e.label,value:e.value},e.label)))),d.createElement("div",null,6048e9!=a&&d.createElement(Ta,{allowClear:!1,value:[ae(l),ae(s)],format:"YYYY-MM-DD HH:mm:ss",onChange:(e,t)=>{let a=e[0],l=e[1];i(a.valueOf(),l.valueOf()),n(-1)},showTime:!0})))},Va=e=>{var{value:t,onChange:a,isKeyValue:n=!0,placeText:l="变量"}=e;s(e,["value","onChange","isKeyValue","placeText"]);const[r,o]=d.useState([]),i=`${l}名`,c=`${l}值`;d.useEffect((()=>{let e=[];if(n)e=(null==t?void 0:t.split(" ").filter((e=>{if(-1===e.indexOf("="))return!1;{const[t,a]=e.split("=");return!(!t||!a)}})).map((e=>{const[t,a]=e.split("=");return{key:t,value:a}})))||[{key:"",value:""}];else if(!n&&t)try{Object.keys(t).forEach((a=>{e.push({key:a,value:t[a]})}))}catch(a){}o(e)}),[t]);const m=()=>{if(a)if(n){let e="";r.forEach((t=>{const{key:a,value:n}=t;a&&n&&(e+=`${a}=${n} `)})),a(e)}else{const e={};r.forEach((t=>{const{key:a,value:n}=t;a?e[a]=n:e.key=n})),a(e)}},u=e=>{r.splice(e,1),o([...r])},p=()=>{r.push({key:"",value:""}),o([...r])};return d.createElement(d.Fragment,null,r.length>0?r.map(((e,t)=>d.createElement(z,{key:t},d.createElement(j,null,d.createElement(x,{addonBefore:i,value:e.key,placeholder:n?"tagKey":`请输入${l}名`,style:{width:180},onChange:e=>((e,t)=>{if(r[t].key=e.target.value,o([...r]),n)m();else{const{key:e,value:a}=r[t];e&&a&&m()}})(e,t)})),n?d.createElement(j,{span:2},d.createElement("span",{style:{textAlign:"center",width:"100%",display:"inline-block",height:32,lineHeight:"32px"}},"=")):null,d.createElement(j,{offset:n?0:2},d.createElement(x,{addonBefore:c,value:e.value,placeholder:n?"tagValue":`请输入${l}值`,style:{width:180},width:200,onChange:e=>((e,t)=>{if(r[t].value=e.target.value,o([...r]),n)m();else{const{key:e,value:a}=r[t];e&&a&&m()}})(e,t)})),d.createElement(j,{offset:1,style:{marginBottom:t===r.length-1?0:24,lineHeight:"32px"}},t===r.length-1?d.createElement(d.Fragment,null,d.createElement(le,{style:{marginRight:"8px"},onClick:()=>u(t)}),d.createElement(re,{onClick:()=>p()})):d.createElement(le,{onClick:()=>u(t)}))))):d.createElement(re,{onClick:()=>p()}))},{confirm:Ma}=$,{TextArea:za}=x,{Option:ja}=V,Ba={wrapperCol:{xs:{span:24},sm:{span:16}}},Ha=[15,30,60,90,120,300,600,1800,3600],qa=[{value:"count",key:"count",label:"count(对符合规则的日志进行计数)",children:null},{value:"histogram",key:"histogram",label:"histogram(对符合规则的日志抓取出的数字计算统计值)",children:null}],Ua=({onChange:e=(()=>{}),value:t=0})=>d.createElement(d.Fragment,null,d.createElement(se,{style:{width:150},onChange:e,value:t})," ","秒"),Ka=({onChange:e=(()=>{}),value:t=""})=>d.createElement(d.Fragment,null,d.createElement(V,{style:{width:150},onChange:e,value:t},Ha.map((e=>d.createElement(ja,{key:e,value:e},e))))," ","秒"),Ya=e=>{let t=e[e.length-1];if(t&&!/\w+=\w+/.test(t)){let t=e.pop();S.error(`"${t}"不符合输入规范（格式为key=value）`)}},Ja=[{key:"resource",title:"资源",component:({activeKey:e,currentKey:t})=>{const[a,n]=d.useState(!1),l=C(),[s,o]=d.useState([]),[i,m]=d.useState([]),[u,h]=d.useState(""),[E,f]=d.useState(""),g=d.useRef(null),{group:{common:y},resourceData:{resourceDetail:v},currentGroup:k,prefix:b}=c((e=>e.resource));d.useEffect((()=>{e===t&&!a&&(null==k?void 0:k.id)&&n(!0)}),[e,t,a,k]),d.useEffect((()=>{o([]),m([])}),[null==k?void 0:k.id]);const N=[{title:d.createElement("div",null,"资源标识 ",d.createElement(T,{placement:"top",title:"复制已选项"},d.createElement(L,{onClick:()=>{""===E?S.warning("请先选择资源标识"):mt(E)}}))),dataIndex:"ident",filterIcon:"copy",render:(e,t)=>{const a=Za({record:t,dispatch:l,ref:g});return d.createElement("div",null,d.createElement(Ot,r({},a)))}},{title:"资源名称",dataIndex:"alias"},{title:"标签",dataIndex:"tags",ellipsis:!0,render:(e,t)=>d.createElement("span",null,t.tags?t.tags.split(" ").map((e=>d.createElement(R,{key:e,color:"blue"},e))):"")},{title:"备注",dataIndex:"note",ellipsis:!0,render:(e,t)=>d.createElement("span",null,t.note||"")},{title:"操作",dataIndex:"operator",width:200,render:(e,t)=>d.createElement("div",{className:"table-operator-area"},d.createElement(ht,r({},sn({etime:t.mute_etime,btime:t.mute_btime},[t.id],(()=>{var e;null==(e=null==g?void 0:g.current)||e.refreshList()})))),d.createElement("div",{className:"table-operator-area-warning",onClick:()=>{(null==k?void 0:k.id)&&Ft({title:"是否移除该资源?",icon:d.createElement(D,null),onOk:()=>{_t(null==k?void 0:k.id,[t.ident]).then((()=>{var e;null==(e=null==g?void 0:g.current)||e.refreshList()}))},onCancel(){}})}},"移除"))}],_=d.useCallback((()=>({fetchParams:{id:(null==k?void 0:k.id)||"",query:u,prefix:b},fetchHandle:bt,autoFetch:!1,initFetch:a,columns:N,rowKey:"ident",rowSelection:{selectedRowKeys:s,onChange:(e,t)=>{let a=[];for(const l of t)a.push(l.ident.trim());let n=a.join("\n").trim();f(n),o(e),m(t)}}})),[null==k?void 0:k.id,a,s,u,b]),x=d.useMemo((()=>d.createElement("ul",{className:"ant-dropdown-menu"},d.createElement("li",{className:"ant-dropdown-menu-item"},s.length?d.createElement(ht,r({},sn({etime:0,btime:0},s,(()=>{var e;null==(e=null==g?void 0:g.current)||e.refreshList()})))):d.createElement("div",{onClick:()=>{S.warning("您未选用任何资源")}},"维护时间")),d.createElement("li",{className:"ant-dropdown-menu-item"},d.createElement("span",{onClick:()=>{s.length?Ft({title:"是否移除该资源?",icon:d.createElement(D,null),onOk:()=>{(null==k?void 0:k.id)&&_t(null==k?void 0:k.id,i.map((e=>e.ident))).then((()=>{var e;null==(e=null==g?void 0:g.current)||e.refreshList()}))},onCancel(){}}):S.warning("您未选用任何资源")}},"移除")))),[s]);return d.createElement("div",null,d.createElement("div",{className:"table-search-area"},d.createElement(nt,{style:{width:"400px"},placeholder:"资源信息或标签",onSearch:e=>{h(e)}}),d.createElement("div",{className:"table-search-area-right"},d.createElement(ht,r({},Xa([(null==k?void 0:k.id)||""],(()=>{var e;null==(e=null==g?void 0:g.current)||e.refreshList()})))),d.createElement(F,{overlay:x,trigger:["click"]},d.createElement(p,{onClick:e=>e.stopPropagation(),style:{marginLeft:8}},"更多操作",d.createElement(G,{style:{marginLeft:2}}))))),d.createElement(Dt,r({ref:g},_())))}},{key:"explorer",title:"看图",component:Fa},{key:"port",title:"端口",component:e=>{var t,a,n;const l=c((e=>e.resource)),s=d.useRef(null),o=()=>{s.current.refreshList()},i=r({fetchHandle:$t("port"),searchPlaceHolder:"端口信息",columns:Qa({classpath_name:(null==(t=null==l?void 0:l.currentGroup)?void 0:t.path)||""},o,"port"),createModalProps:an({classpath_name:(null==(a=null==l?void 0:l.currentGroup)?void 0:a.path)||"",classpath_id:(null==(n=null==l?void 0:l.currentGroup)?void 0:n.id)||0,type:"port"},o)},e);return d.createElement(ta,r({ref:s},i))}},{key:"service",title:"进程",component:e=>{var t,a,n;const l=c((e=>e.resource)),s=d.useRef(null),o=()=>{s.current.refreshList()},i=r({fetchHandle:$t("process"),searchPlaceHolder:"进程信息",columns:Qa({classpath_name:(null==(t=null==l?void 0:l.currentGroup)?void 0:t.path)||""},o,"process"),createModalProps:tn({classpath_name:(null==(a=null==l?void 0:l.currentGroup)?void 0:a.path)||"",classpath_id:(null==(n=null==l?void 0:l.currentGroup)?void 0:n.id)||0,type:"process"},o)},e);return d.createElement(ta,r({ref:s},i))}},{key:"plugin",title:"插件",component:e=>{var t,a,n;const l=c((e=>e.resource)),s=d.useRef(null),o=()=>{s.current.refreshList()},i=r({fetchHandle:$t("script"),searchPlaceHolder:"插件信息",columns:Qa({classpath_name:(null==(t=null==l?void 0:l.currentGroup)?void 0:t.path)||""},o,"script"),createModalProps:nn({classpath_name:(null==(a=null==l?void 0:l.currentGroup)?void 0:a.path)||"",classpath_id:(null==(n=null==l?void 0:l.currentGroup)?void 0:n.id)||0,type:"script"},o)},e);return d.createElement(ta,r({ref:s},i))}},{key:"log",title:"日志",component:e=>{var t,a,n;const l=c((e=>e.resource)),s=d.useRef(null),o=()=>{s.current.refreshList()},i=r({fetchHandle:$t("log"),searchPlaceHolder:"日志信息",columns:Qa({classpath_name:(null==(t=null==l?void 0:l.currentGroup)?void 0:t.path)||""},o,"log"),createModalProps:ln({classpath_name:(null==(a=null==l?void 0:l.currentGroup)?void 0:a.path)||"",classpath_id:(null==(n=null==l?void 0:l.currentGroup)?void 0:n.id)||0,type:"log"},o)},e);return d.createElement(ta,r({ref:s},i))}}],Wa=new Map([["port","端口号"],["process","进程标识"],["script","插件路径"],["log","日志路径"]]),Qa=({classpath_name:e},t,a)=>{const n=[{title:"采集名称",dataIndex:"name",render:(n,l)=>d.createElement(ht,r({},rn.get(a)(r(r({},l),{type:a,classpath_name:e}),t,!1)))},{title:Wa.get(a),dataIndex:"data",render:(e,t)=>{let n;try{n=JSON.parse(e)}catch(l){n={}}switch(a){case"port":return d.createElement(d.Fragment,null,null==n?void 0:n.port);case"process":return d.createElement(d.Fragment,null,null==n?void 0:n.param);case"script":return d.createElement(d.Fragment,null,null==n?void 0:n.path);case"log":return d.createElement(d.Fragment,null,null==n?void 0:n.file_path)}}},{title:"采集频率",dataIndex:"step",render:(e,t)=>d.createElement(d.Fragment,null,t.step,"s")},{title:"备注",dataIndex:"note",render:e=>d.createElement(d.Fragment,null,e||"")},{title:"修改人",dataIndex:"update_by"},{title:"修改时间",dataIndex:"update_at",render:e=>d.createElement(d.Fragment,null,B(1e3*e).format("YYYY-MM-DD HH:mm:ss"))},{title:"操作",dataIndex:"operator",render:(n,l)=>d.createElement("div",{className:"table-operator-area"},d.createElement(ht,r({},rn.get(a)(r(r({},l),{type:a,classpath_name:e}),t,!0,!0))),d.createElement("div",{className:"table-operator-area-warning",onClick:()=>{Ma({title:"是否删除该采集策略?",onOk:()=>{It([l.id]).then((()=>{S.success("删除成功"),t&&t()}))},onCancel(){}})}},"删除"))}];return"log"===a&&n.splice(2,1),n},Xa=(e,t)=>({customizeButton:d.createElement(p,{type:"primary",onClick:()=>{}},"添加资源"),modalName:"添加资源",handlePromiseOk:Ct,beforePromiseOk:t=>({data:t.data.split("\n"),id:e[0]}),afterPromiseOk:(e,a,n)=>{t()},formLayout:"vertical",children:e=>d.createElement(d.Fragment,null,d.createElement(_,{form:e,layout:"vertical",preserve:!1},d.createElement(_.Item,{name:"data",label:"资源标识",rules:[{required:!0,message:"请输入资源标识"}]},d.createElement(za,{placeholder:"请输入资源标识，每行一个"}))))}),Za=({record:e,dispatch:t,ref:a})=>({title:d.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},d.createElement("span",null,e.ident),d.createElement(L,{style:{marginLeft:8,cursor:"pointer"},onClick:()=>{mt(e.ident)}})),payload:{dispatch:t,data:e},renderTrigger:({open:t,payload:{dispatch:a}})=>d.createElement("span",{style:{cursor:"pointer",color:"#1473ff",marginRight:16},onClick:()=>{a({type:"resource/getResourceItem",id:e.id}),t()}},e.ident),footer:"",renderContent:()=>d.createElement(ma,null),onConfirm:()=>{var e;return null==(e=null==a?void 0:a.current)||e.refreshList(),Promise.resolve()},width:900}),en=(e,t=!0)=>({modalName:t?"新建资源分组":"编辑资源分组",customizeButton:t?d.createElement("a",{type:"primary"},"新建资源分组"):d.createElement(A,{title:"刷新",style:{marginLeft:"8px",fontSize:"14px"}}),handlePromiseOk:t?Et:kt,afterPromiseOk:(e,t,a)=>{a({type:"resource/getGroup",sign:"refresh"})},setFields:async a=>{t||a.setFieldsValue(r({},e))},children:d.createElement(d.Fragment,null,d.createElement(_.Item,{name:"path",key:"path",label:"资源分组路径",wrapperCol:{span:24},rules:[{required:!0,message:"资源分组路径必填"}]},d.createElement(x,{placeholder:"请填写资源分组路径"})),d.createElement(_.Item,{wrapperCol:{span:24},name:"note",key:"备注",label:"资源分组备注"},d.createElement(x,{placeholder:"请填写资源分组备注"})),d.createElement(_.Item,{name:"id",key:"id",noStyle:!0}))}),tn=(e,t,a=!0,n=!1)=>({customizeButton:a?n?d.createElement("div",{className:"table-operator-area-normal"},"克隆"):d.createElement(p,{type:"primary"},"创建进程采集"):d.createElement("div",{className:"table-active-text"},null==e?void 0:e.name),modalName:a?"创建进程采集":"进程采集详情",handlePromiseOk:a?wt:St,formLayout:"horizontal",setFields:async t=>{if(!a||n){let a;try{a=JSON.parse((null==e?void 0:e.data)||"{}")}catch(l){a={}}t.setFieldsValue(r(r({},e),{method:(null==a?void 0:a.method)||la.CmdLine,param:(null==a?void 0:a.param)||0,append_tags:""==(null==e?void 0:e.append_tags)?[]:(null==e?void 0:e.append_tags).split(" "),prefix_match:(null==e?void 0:e.prefix_match)===aa.Need||!1}))}else t.setFieldsValue(r({},e))},beforePromiseOk:e=>(e.data=JSON.stringify({method:e.method,param:e.param}),e.append_tags=((null==e?void 0:e.append_tags)||[]).join(" "),e.prefix_match=e.prefix_match?aa.Need:aa.UnNeed,e),modalProps:{width:800},afterPromiseOk:()=>{t&&t(),S.success((a?"创建":"更新")+"告警成功")},children:t=>d.createElement(d.Fragment,null,d.createElement(_.Item,{label:"进程监控指标",key:"intric"},d.createElement("div",null,"proc_num")),d.createElement(_.Item,{label:"所属资源分组",rules:[{required:!0,message:"资源分组必填"}],name:"classpath_id",key:"classpath_id"},d.createElement("div",null,(null==e?void 0:e.classpath_name)||"")),d.createElement(_.Item,{valuePropName:"checked",label:"匹配前缀",name:"prefix_match",key:"prefix_match"},d.createElement(W,null)),d.createElement(_.Item,{label:"采集名称",rules:[{required:!0,message:"采集名称必填"}],name:"name",key:"name"},d.createElement(x,{placeholder:"请输入进程采集配置的名称, eg:nginx进程采集"})),d.createElement(_.Item,{label:"采集方式",rules:[{required:!0,message:"采集方式必填"}],name:"method",key:"method",initialValue:la.CmdLine},d.createElement(ee.Group,{buttonStyle:"solid"},d.createElement(ee.Button,{value:la.CmdLine},"命令行"),d.createElement(ee.Button,{value:la.Name},"进程名"))),d.createElement(_.Item,{noStyle:!0,shouldUpdate:!0,style:{marginBottom:0}},(()=>d.createElement(_.Item,r(r({},Ba),{name:"param",key:"param",rules:[{required:!0,message:"该项必填"}],label:"cmdline"===t.getFieldsValue().method?"命令行":"进程名"}),d.createElement(x,{placeholder:"cmdline"===t.getFieldsValue().method?"取 /proc/$pid/cmdline 中的部分子串，可以唯一标识进程即可":"取  /proc/$pid/status 中 name 的值"})))),d.createElement(_.Item,{label:"采集周期",rules:[{required:!0,message:"采集周期必填"}],name:"step",key:"step",initialValue:15},d.createElement(Ka,null)),d.createElement(_.Item,{label:"附加标签",style:{marginTop:20},name:"append_tags"},d.createElement(V,{mode:"tags",onChange:Ya,placeholder:"格式为key=value回车分隔"})),d.createElement(_.Item,{label:"备注",name:"note",key:"note"},d.createElement(x,{placeholder:"请填写备注信息"})),d.createElement(_.Item,{noStyle:!0,name:"type",key:"type"}),d.createElement(_.Item,{noStyle:!0,name:"id",key:"id"}))}),an=(e,t,a=!0,n=!1)=>({customizeButton:a?n?d.createElement("div",{className:"table-operator-area-normal"},"克隆"):d.createElement(p,{type:"primary"},"创建端口采集"):d.createElement("div",{className:"table-active-text"},null==e?void 0:e.name),modalName:a?"创建端口采集":"端口采集详情",handlePromiseOk:a?wt:St,formLayout:"horizontal",setFields:async t=>{if(!a||n){let a;try{a=JSON.parse((null==e?void 0:e.data)||"{}")}catch(l){a={}}t.setFieldsValue(r(r({},e),{port:(null==a?void 0:a.port)||0,timeout:null==a?void 0:a.timeout,protocol:(null==a?void 0:a.protocol)||sa.TCP,append_tags:""==(null==e?void 0:e.append_tags)?[]:(null==e?void 0:e.append_tags).split(" "),prefix_match:(null==e?void 0:e.prefix_match)===aa.Need||!1}))}else t.setFieldsValue(r({},e))},beforePromiseOk:e=>(e.data=JSON.stringify({port:e.port,protocol:e.protocol,timeout:e.timeout}),e.append_tags=((null==e?void 0:e.append_tags)||[]).join(" "),e.prefix_match=e.prefix_match?aa.Need:aa.UnNeed,e),afterPromiseOk:()=>{t&&t(),S.success((a?"创建":"更新")+"告警成功")},modalProps:{width:800},children:d.createElement(d.Fragment,null,d.createElement(_.Item,{label:"端口监控指标",key:"intric"},d.createElement("div",null,"proc_port_listen")),d.createElement(_.Item,{label:"所属资源分组",rules:[{required:!0,message:"资源分组必填"}],name:"classpath_id",key:"classpath_id"},d.createElement("div",null,(null==e?void 0:e.classpath_name)||"")),d.createElement(_.Item,{valuePropName:"checked",label:"匹配前缀",name:"prefix_match",key:"prefix_match"},d.createElement(W,null)),d.createElement(_.Item,{label:"采集名称",rules:[{required:!0,message:"采集名称必填"}],name:"name",key:"name"},d.createElement(x,{placeholder:"请输入端口采集配置的名称, eg:web端口采集"})),d.createElement(_.Item,{label:"端口协议",rules:[{required:!0,message:"端口协议必填"}],name:"protocol",key:"protocol",initialValue:sa.TCP},d.createElement(ee.Group,{buttonStyle:"solid"},d.createElement(ee.Button,{value:sa.TCP},"TCP"),d.createElement(ee.Button,{value:sa.UDP},"UDP"))),d.createElement(_.Item,{label:"端口号",rules:[{required:!0,message:"端口号必填"}],name:"port",key:"port"},d.createElement(se,{style:{width:150},placeholder:"请输入端口号"})),d.createElement(_.Item,{label:"连接超时",rules:[{required:!0,message:"连接超时必填"}],initialValue:10,name:"timeout",key:"timeout"},d.createElement(Ua,null)),d.createElement(_.Item,{label:"采集周期",rules:[{required:!0,message:"采集周期必填"}],initialValue:15,name:"step",key:"step"},d.createElement(Ka,null)),d.createElement(_.Item,{label:"附加标签",style:{marginTop:20},name:"append_tags"},d.createElement(V,{mode:"tags",onChange:Ya,placeholder:"格式为key=value回车分隔"})),d.createElement(_.Item,{label:"备注",name:"note",key:"note"},d.createElement(x,{placeholder:"请填写备注信息"})),d.createElement(_.Item,{noStyle:!0,name:"type",key:"type"}),d.createElement(_.Item,{noStyle:!0,name:"id",key:"id"}))}),nn=(e,t,a=!0,n=!1)=>({customizeButton:a?n?d.createElement("div",{className:"table-operator-area-normal"},"克隆"):d.createElement(p,{type:"primary"},"创建插件采集"):d.createElement("div",{className:"table-active-text"},null==e?void 0:e.name),modalName:a?"创建插件采集":"插件采集详情",handlePromiseOk:a?wt:St,formLayout:"horizontal",setFields:async t=>{if(!a||n){let a;try{a=JSON.parse((null==e?void 0:e.data)||"{}")}catch(l){a={}}t.setFieldsValue(r(r({},e),{path:(null==a?void 0:a.path)||"",params:(null==a?void 0:a.params)||"",stdin:(null==a?void 0:a.stdin)||"",env:(null==a?void 0:a.env)||"",prefix_match:(null==e?void 0:e.prefix_match)===aa.Need||!1}))}else t.setFieldsValue(r({},e))},beforePromiseOk:e=>(e.data=JSON.stringify({path:e.path,params:e.params,stdin:e.stdin,env:e.env}),e.prefix_match=e.prefix_match?aa.Need:aa.UnNeed,e),modalProps:{width:800},afterPromiseOk:()=>{t&&t(),S.success((a?"创建":"更新")+"插件采集成功")},children:d.createElement(d.Fragment,null,d.createElement(_.Item,{label:"所属资源分组",rules:[{required:!0,message:"资源分组必填"}],name:"classpath_id",key:"classpath_id"},d.createElement("div",null,(null==e?void 0:e.classpath_name)||"")),d.createElement(_.Item,{valuePropName:"checked",label:"匹配前缀",name:"prefix_match",key:"prefix_match"},d.createElement(W,null)),d.createElement(_.Item,{label:"采集名称",rules:[{required:!0,message:"采集名称必填"}],name:"name",key:"name"},d.createElement(x,{placeholder:"请输入插件采集配置的名称, eg:nginx插件采集"})),d.createElement(_.Item,{label:"文件路径",rules:[{required:!0,message:"文件路径必填"}],name:"path",key:"path"},d.createElement(x,{placeholder:"文件路径"})),d.createElement(_.Item,{label:"参数",name:"params",key:"params"},d.createElement(x,{placeholder:"请输入参数"})),d.createElement(_.Item,{label:"环境变量",name:"env",key:"env"},d.createElement(Va,{isKeyValue:!1})),d.createElement(_.Item,{label:"标准输入(Stdin)",name:"stdin",key:"stdin"},d.createElement(za,{placeholder:"请输入参数"})),d.createElement(_.Item,{label:"采集周期",rules:[{required:!0,message:"采集周期必填"}],initialValue:60,name:"step",key:"step"},d.createElement(V,{style:{width:150}},Ha.map((e=>d.createElement(ja,{key:e,value:e},e))))),d.createElement(_.Item,{label:"备注",name:"note",key:"note"},d.createElement(x,{placeholder:"请填写备注信息"})),d.createElement(_.Item,{noStyle:!0,name:"type",key:"type"}),d.createElement(_.Item,{noStyle:!0,name:"id",key:"id"}))}),ln=(e,t,a=!0,n=!1)=>({customizeButton:a?n?d.createElement("div",{className:"table-operator-area-normal"},"克隆"):d.createElement(p,{type:"primary"},"创建日志采集"):d.createElement("div",{className:"table-active-text"},null==e?void 0:e.name),modalProps:{width:800},modalName:a?"创建日志采集":"日志采集详情",handlePromiseOk:a?wt:St,formLayout:"horizontal",setFields:async t=>{var l;if(e.name){let t=null==(l=null==e?void 0:e.name)?void 0:l.slice(4);e.name=t}if(!a||n){let a;try{a=JSON.parse((null==e?void 0:e.data)||"{}")}catch(s){a={}}t.setFieldsValue(r(r({},e),{file_path:(null==a?void 0:a.file_path)||"",func:(null==a?void 0:a.func)||"",pattern:(null==a?void 0:a.pattern)||"",tags_pattern:(null==a?void 0:a.tags_pattern)||{},append_tags:""==(null==e?void 0:e.append_tags)?[]:(null==e?void 0:e.append_tags).split(" "),prefix_match:(null==e?void 0:e.prefix_match)===aa.Need||!1}))}else t.setFieldsValue(r({},e))},beforePromiseOk:e=>(e.data=JSON.stringify({file_path:e.file_path,func:e.func,pattern:e.pattern,tags_pattern:e.tags_pattern}),e.append_tags=((null==e?void 0:e.append_tags)||[]).join(" "),e.prefix_match=e.prefix_match?aa.Need:aa.UnNeed,e.name="log_"+e.name,e),afterPromiseOk:()=>{t&&t(),S.success((a?"创建":"更新")+"告警成功")},children:t=>d.createElement(d.Fragment,null,d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"所属资源分组",rules:[{required:!0,message:"资源分组必填"}],name:"classpath_id",key:"classpath_id"},d.createElement("div",null,(null==e?void 0:e.classpath_name)||"")))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{valuePropName:"checked",label:"匹配前缀",name:"prefix_match",key:"prefix_match"},d.createElement(W,null)))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"指标名称",rules:[{required:!0,message:"指标名称必填"}],name:"name",key:"name"},d.createElement(x,{addonBefore:"log_",placeholder:"请输入日志采集配置的名称"})))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"计算方法",rules:[{required:!0,message:"计算方法必填"}],name:"func",key:"func"},d.createElement(V,{placeholder:qa[0].label,options:qa})))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"日志路径",rules:[{required:!0,message:"日志路径必填"}],name:"file_path",key:"file_path"},d.createElement(x,{placeholder:"请输入文件路径(带执行插件的绝对路径), eg: /home/ecmc/plugin/docker_mon"}))),d.createElement(j,{style:{lineHeight:"32px"},className:"tooltip-col"},d.createElement(T,{placement:"top",title:"日志末尾自带时间格式，例如 /path/access.log.${%Y%m%d%H}${} 中不能包含 /"},d.createElement(oe,{className:"detail-tooltipIcon"})))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"匹配正则",name:"pattern",key:"pattern",rules:[{required:!0,message:"匹配正则必填"}]},d.createElement(x,{placeholder:"请填写正则表达式,例如 const=(\\d+), 则取\\d+的部分, 默认以第一个括号为准"}))),d.createElement(j,{className:"tooltip-col",style:{lineHeight:"32px"}},d.createElement(T,{placement:"top",title:"耗时计算：中的数值会用于计算曲线值流量计数：每匹配到该正则，曲线值+1"},d.createElement(oe,{className:"detail-tooltipIcon"})))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"标签",name:"tags_pattern",key:"tags_pattern"},d.createElement(Va,{isKeyValue:!1,placeText:"标签"}))),d.createElement(j,{style:{lineHeight:"32px"},className:"tooltip-col"},d.createElement(T,{placement:"top",title:"tagName 填写说明\r\n\n              1. 不允许包含host、trigger、include\n              2. 不允许包含如下4个特殊字符\n              tagValue 填写说明\n              1.必须包含括号。括号中的正则内容被用作tagValue的取值，必须可枚举。\n              2.不允许包含如下4个特殊字符=,:@"},d.createElement(oe,{className:"detail-tooltipIcon"})))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"验证",name:"valiate",key:"valiate"},d.createElement(x,{placeholder:"请输入一行待监控的完整日志"})))),d.createElement(z,{style:{marginTop:"-12px",marginBottom:"12px",marginRight:"30px"}},d.createElement(j,{offset:6},d.createElement(p,{onClick:()=>{const e=t.getFieldsValue();(function(e){return Ve(`${Ue}/api/n9e/log/check`,{method:Me.Post,data:e})})({func:e.func||"",tags_pattern:JSON.stringify(e.tags_pattern||"{}"),re:e.pattern||"",log:e.valiate||""}).then((e=>{const{dat:t,success:a}=e;if(a){const{success:e,tags:a}=t;Ma({zIndex:2001,title:"验证"+(e?"通过":"失败"),content:d.createElement("div",null,a.map(((e,t)=>d.createElement("div",{key:t},JSON.stringify(e))))),okText:"确认",cancelText:"取消"})}}))}},"验证"))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"附加标签",style:{marginTop:20},name:"append_tags"},d.createElement(V,{mode:"tags",onChange:Ya,placeholder:"格式为key=value回车分隔"})))),d.createElement(z,null,d.createElement(j,{span:23},d.createElement(_.Item,{label:"备注",name:"note",key:"note"},d.createElement(x,{placeholder:"请填写备注信息"})))),d.createElement(_.Item,{noStyle:!0,name:"type",key:"type"}),d.createElement(_.Item,{noStyle:!0,name:"id",key:"id"}))}),rn=new Map([["port",an],["process",tn],["script",nn],["log",ln]]),sn=(e,t,a)=>({customizeButton:d.createElement("div",{className:"table-operator-area-normal"},"维护时间"),modalName:"维护时间",handlePromiseOk:({pickerData:e})=>function(e){return Ve(`${Ue}/api/n9e/resources/mute`,{method:Me.Put,data:e})}(r({ids:t},e)),afterPromiseOk:()=>{a&&a()},setFields:async t=>{t.setFieldsValue({pickerData:{btime:e.btime,etime:e.etime}})},modalProps:{width:1100},children:d.createElement(d.Fragment,null,d.createElement(_.Item,{label:"选择时间",name:"pickerData",style:{width:"100%"}},d.createElement(Aa,{value:e})))}),on=(e,t)=>({customizeButton:d.createElement("a",{style:{marginRight:8,color:"#000"},type:"primary",onClick:()=>{}},"克隆到其他资源分组"),modalName:"选择资源分组",handlePromiseOk:e=>{let t=[];return e.classpath_ids.forEach((a=>{e.res_idents.forEach((e=>{e.classpath_id=a,t.push(JSON.parse(JSON.stringify(e)))}))})),Pt(t)},afterPromiseOk:e=>{S.success("克隆成功")},formLayout:"vertical",setFields:async t=>{t.setFieldsValue({res_idents:e})},children:e=>d.createElement(d.Fragment,null,d.createElement(_,{form:e,layout:"vertical",preserve:!1},d.createElement(_.Item,{name:"classpath_ids",label:"资源分组",rules:[{required:!0,message:"分组不可为空"}]},d.createElement(V,{mode:"multiple",allowClear:!0,size:"small"},t.map((e=>d.createElement(ja,{key:e.id,title:e.path,value:e.id},e.path))))),d.createElement(_.Item,{name:"res_idents"})))}),cn=function(e,t=1){return Ve(`${Ue}/api/n9e/alert-rule-groups`,{method:Me.Get,params:{query:e,p:t,limit:15}})},mn=function(e){return Ve(`${Ue}/api/n9e/alert-rule-groups`,{method:Me.Post,data:e})},un=function(e){return Ve(`${Ue}/api/n9e/alert-rule-group/${e}`,{method:Me.Delete})},dn=function(e){return Ve(`${Ue}/api/n9e/alert-rule-group/${e.id}`,{method:Me.Put,data:e})},pn=function(e){return Ve(`${Ue}/api/n9e/alert-rule-group/${e.id}/alert-rules`,{method:Me.Get})},hn=function(e){return Ve(`${Ue}/api/n9e/alert-rule-group/${e}/favorites`,{method:Me.Post,data:{id:e}})},En=function(e){return Ve(`${Ue}/api/n9e/alert-rule-group/${e}/favorites`,{method:Me.Delete,data:{id:e}})},fn=function(e){return Ve(`${Ue}/api/n9e/tag-keys`,{method:Me.Post,data:e})},gn=function(e){return Ve(`${Ue}/api/n9e/tag-values`,{method:Me.Post,data:e})},yn=function(e){return Ve(`${Ue}/api/n9e/alert-rule/${e}`,{method:Me.Get})},vn=function(e,t){let a=`${Ue}/api/n9e/alert-rules`;return t&&(a=`${Ue}/api/n9e/alert-rule/${t}`),Ve(a,{method:t?Me.Put:Me.Post,data:t?e[0]:e})},kn=function(e){return Ve(`${Ue}/api/n9e/alert-events`,{method:Me.Get,params:e})},bn=function(e){return Ve(`${Ue}/api/n9e/alert-event/${e}`,{method:Me.Get})},Nn=function(e){return Ve(`${Ue}/api/n9e/alert-events`,{method:Me.Delete,data:{ids:e}})},{Option:_n}=V,Cn=(e,t,a,n)=>({customizeButton:e?d.createElement("a",{type:"primary"},"新建策略分组"):d.createElement(A,{title:"刷新",style:{marginLeft:"8px",fontSize:"14px"}}),modalName:e?"新建策略分组":"编辑策略组",setFields:e=>{"string"==typeof(null==a?void 0:a.user_group_ids)&&(a.user_group_ids=a.user_group_ids.split(" ").map((e=>Number(e)))),e.setFieldsValue(a)},handlePromiseOk:e?mn:dn,beforePromiseOk:e=>(Array.isArray(e.user_group_ids)&&(e.user_group_ids=e.user_group_ids.join(" ")),e),formLayout:"horizontal",afterPromiseOk:(e,t,a)=>{a({type:"strategy/getGroup",sign:"refresh"}),n&&n()},children:d.createElement(d.Fragment,null,d.createElement(_.Item,{name:"name",key:"name",label:"策略组名称",rules:[{required:!0,message:"策略组名称必填"}]},d.createElement(x,{placeholder:"请填写策略组名称"})),d.createElement(_.Item,{name:"user_group_ids",key:"user_group_ids",label:"管理团队"},d.createElement(V,{mode:"multiple",placeholder:"请选择团队"},t.map((e=>d.createElement(_n,{key:e.id,value:e.id},e.name))))),d.createElement(_.Item,{name:"id",key:"id",noStyle:!0}))}),xn=function(e={}){return Ve(`${Ue}/api/n9e/users`,{method:Me.Get,params:e})},wn=function(e={}){return Ve(`${Ue}/api/n9e/user-groups`,{method:Me.Get,params:e})},Pn=function(e){return Ve(`${Ue}/api/n9e/users`,{method:Me.Post,data:e}).then((e=>e&&e.dat))},Sn=function(e){return Ve(`${Ue}/api/n9e/user-groups`,{method:Me.Post,data:e}).then((e=>e&&e.dat))},$n=function(e){return Ve(`${Ue}/api/n9e/user/${e}/profile`,{method:Me.Get}).then((e=>e&&e.dat))},In=function(e){return Ve(`${Ue}/api/n9e/user-group/${e}`,{method:Me.Get}).then((e=>e&&e.dat))},On=function(e,t){return Ve(`${Ue}/api/n9e/user/${e}/profile`,{method:Me.Put,data:t}).then((e=>e&&e.dat))},Dn=function(e,t){return Ve(`${Ue}/api/n9e/user/${e}/status`,{method:Me.Put,data:t}).then((e=>e&&e.dat))},Fn=function(e,t){return Ve(`${Ue}/api/n9e/user-group/${e}`,{method:Me.Put,data:t}).then((e=>e&&e.dat))},Gn=function(e,t){return Ve(`${Ue}/api/n9e/user/${e}/password`,{method:Me.Put,data:t}).then((e=>e&&e.dat))},Tn=function(e){return Ve(`${Ue}/api/n9e/user/${e}`,{method:Me.Delete}).then((e=>e&&e.dat))},Ln=function(e){return Ve(`${Ue}/api/n9e/user-group/${e}`,{method:Me.Delete}).then((e=>e&&e.dat))},Rn=function(e,t){return Ve(`${Ue}/api/n9e/user-group/${e}/members`,{method:Me.Delete,data:t}).then((e=>e&&e.dat))},An=function(e,t){return Ve(`${Ue}/api/n9e/user-group/${e}/members`,{method:Me.Post,data:t}).then((e=>e&&e.dat))},Vn=function(){return Ve(`${Ue}/api/n9e/notify-channels`,{method:Me.Get}).then((e=>e&&e.dat))},Mn=function(){return Ve(`${Ue}/api/n9e/contact-channels`,{method:Me.Get}).then((e=>e&&e.dat))},zn=d.memo((function({item:e,groupType:t,pathKey:a,treeType:n}){var l,s;const[o,i]=d.useState(!1),u=C(),p=c((e=>e[n])),[h,E]=d.useState(""),f=m();d.useEffect((()=>{E(e[a])}),[e[a]]);const g=()=>{u({type:`${n}/changeGroupFavorite`,id:e.id,favorType:e.isFavorite?je.Delete:je.Add})};return d.createElement(lt,null,d.createElement("div",{className:ie("left-tree-item",(null==(l=null==p?void 0:p.currentGroup)?void 0:l.id)===e.id&&(null==(s=null==p?void 0:p.currentGroup)?void 0:s.isBelongIn)===t?"left-tree-item-active":""),onClick:()=>{f.push({pathname:`/${n}/${e.id}`}),u({type:`${n}/chooseGroupItem`,data:e})},onDoubleClick:e=>{e.stopPropagation(),i(!0)}},e.isFavorite?d.createElement(ce,{onClick:g,className:ie("left-tree-item-icon","left-tree-item-icon-active")}):d.createElement(me,{onClick:g,className:"left-tree-item-icon"}),o?d.createElement("input",{autoFocus:!0,className:"left-tree-item-input",onChange:e=>{E(e.target.value)},onBlur:()=>{i(!1),h===e[a]||""===h?E(e[a]):u({type:`${n}/updateGroup`,id:e.id,data:r(r({},e),{[a]:h})})},value:h}):d.createElement("div",{className:"left-tree-item-title",title:e[a]||""},e[a]||"")))})),jn=({pathKey:e="path",treeType:t="resource",typeName:a="资源",pageTitle:n})=>{const[l,s]=d.useState([]);d.useEffect((()=>{wn().then((e=>{var t;s((null==(t=null==e?void 0:e.dat)?void 0:t.list)||[])}))}),[]);const o=ue(),{group:{favorite:i,common:m,commonTotal:u,currentPage:p}}=c((e=>e[t])),h=C();d.useEffect((()=>{E()}),[]);const E=()=>{h({type:`${t}/getGroup`,sign:"init",data:(null==o?void 0:o.id)||""})};return d.createElement("div",{className:"left-tree-area"},d.createElement("div",{className:"left-tree-area-item page-title"},n),d.createElement("div",{className:"left-tree-area-item"},d.createElement("div",{className:"left-tree-area-item-title"},"收藏的",a,"分组"),d.createElement("div",{className:"left-tree-area-item-list"},i.map((n=>d.createElement(zn,{key:n.id,isFavorite:!0,item:n,pathKey:e,treeType:t,typeName:a,groupType:He.Favorite}))))),d.createElement("div",{className:"left-tree-area-item"},d.createElement(z,null,d.createElement("div",{className:"left-tree-area-item-title"},"所有",a,"分组"),d.createElement(j,{style:{lineHeight:"38px"},offset:8},"策略"===a?d.createElement(ht,r({},Cn(!0,l))):d.createElement(ht,r({},en())))),d.createElement(nt,{className:"left-tree-area-item-input",placeholder:`请输入${a}分组名称`,onSearch:e=>{h({type:`${t}/getGroup`,sign:"search",data:e})}})),d.createElement("div",{className:"left-tree-area-item"},d.createElement("div",{className:"left-tree-area-item-list"},m.map((n=>d.createElement(zn,{key:n.id,isFavorite:!1,item:n,groupType:He.Common,pathKey:e,treeType:t,typeName:a})))),15*p<u?d.createElement(de,{className:"load-more",onClick:()=>{h({type:`${t}/getGroup`,sign:"append"})}}):null))},{TabPane:Bn}=he,{confirm:Hn}=$,qn=()=>{var e,t;const a=c((e=>e.resource)),[n,l]=d.useState(Ja[0].key),s=C();return d.createElement("div",{className:"resource-table-content"},d.createElement("div",null,d.createElement("div",{className:"resource-table-title"},d.createElement("div",{className:"resource-table-title-label"},(null==(e=null==a?void 0:a.currentGroup)?void 0:e.path)||"",d.createElement(ht,r({},en((null==a?void 0:a.currentGroup)||{},!1))),a&&d.createElement(pe,{onClick:e=>{e.stopPropagation(),Hn({title:"是否确定删除资源分组?",icon:d.createElement(D,null),onOk:()=>{var e;s({type:"resource/deleteGroup",id:null==(e=null==a?void 0:a.currentGroup)?void 0:e.id})},onCancel(){}})},style:{marginLeft:8}})),d.createElement("div",{className:"resource-table-title-sub"},d.createElement(W,{checked:Boolean(a.prefix),onChange:e=>{s({type:"resource/updatePrefix",data:e.target.checked?aa.Need:aa.UnNeed})},style:{color:"rgb(102, 102, 102)"}},"分组名称前缀匹配(聚合展示所有相关分组的内容)"),d.createElement("div",{className:"resource-table-title-sub-item"},"备注:",(null==(t=null==a?void 0:a.currentGroup)?void 0:t.note)||""))),d.createElement(he,{activeKey:n,onChange:l},Ja.map((e=>d.createElement(Bn,{tab:e.title,key:e.key},d.createElement(e.component,{currentKey:e.key,activeKey:n,isIdent:!0})))))))};const Un=()=>d.createElement("div",{className:"resource-content"},d.createElement(jn,{pageTitle:"资源管理"}),d.createElement(qn,null));var Kn,Yn,Jn,Wn,Qn,Xn,Zn,el,tl,al,nl,ll;(Yn=Kn||(Kn={}))[Yn.n9e=0]="n9e",Yn[Yn.prometheus=1]="prometheus",(Wn=Jn||(Jn={}))[Wn.Enable=0]="Enable",Wn[Wn.UnEnable=1]="UnEnable",(Xn=Qn||(Qn={}))[Xn.Send=0]="Send",Xn[Xn.UnSend=1]="UnSend",(el=Zn||(Zn={}))[el.First=1]="First",el[el.Second=2]="Second",el[el.Third=3]="Third",(al=tl||(tl={}))[al.Favorite=0]="Favorite",al[al.Common=1]="Common",(ll=nl||(nl={})).add="add",ll.edit="edit";const rl=e=>{var{text:t}=e,a=s(e,["text"]);return Array.from(t).reduce(((e,t)=>e+t.charCodeAt(0)),0),d.createElement(R,r({color:"blue"},a),t)};const{TextArea:sl}=x;var ol,il;function cl(e){const t=d.useRef(null),{status:a,title:n,exportData:l,description:r,onClose:s,onSubmit:o}=e,[i]=_.useForm();return d.createElement($,{title:a===ol.Export?"导出"+n:"导入"+n,destroyOnClose:!0,footer:a===ol.Import&&d.createElement(d.Fragment,null,d.createElement(p,{key:"delete",onClick:()=>s()},"取消"),d.createElement(p,{key:"submit",type:"primary",onClick:async()=>{await i.validateFields();const e=i.getFieldsValue();await o(e.import),S.success("导入成功"),s()}},"确定")),onCancel:()=>s(),visible:"hide"!==a},d.createElement("p",{style:{color:"#999"}},r,a===ol.Export&&d.createElement("a",{onClick:()=>{ct([l],"download.json")}},"Download.json")),(()=>{switch(a){case ol.Export:return d.createElement("div",{contentEditable:"true",suppressContentEditableWarning:!0,ref:t,className:"export-dialog"},d.createElement("pre",null,l));case ol.Import:return d.createElement(_,{form:i,preserve:!1},d.createElement(_.Item,{name:"import",rules:[{required:!0,message:"请输出"+n,validateTrigger:"trigger"}]},d.createElement(sl,{placeholder:"请输出"+n,rows:4})))}})())}(il=ol||(ol={})).Import="import",il.Export="export",il.None="hide";const{confirm:ml}=$,ul=Object.fromEntries(["append_tags","callbacks","create_by","group_id","id","notify_groups","notify_users","update_at","update_by"].map((e=>[e,void 0]))),dl=()=>{var e;const t=m(),a=d.useRef(null),n=C();d.useRef(null);const[l,s]=d.useState(ol.None),[o,i]=d.useState([]),[u,h]=d.useState(!1),[E,f]=d.useState([]),[g,y]=d.useState([]),[v,k]=d.useState(""),[b,N]=d.useState({}),{currentGroup:_}=c((e=>e.strategy)),[x,w]=d.useState([]),[P,$]=d.useState("");d.useState(!1),d.useEffect((()=>{}),[]),d.useEffect((()=>{Xt("alert_rule").then((e=>{w(e.dat)})),wn().then((e=>{var t;i((null==(t=null==e?void 0:e.dat)?void 0:t.list)||[])}))}),[]),d.useEffect((()=>{(null==_?void 0:_.id)&&(I(),h(!0))}),[null==_?void 0:_.id]);const I=()=>{var e;(null==_?void 0:_.id)&&(e=_.id,Ve(`${Ue}/api/n9e/alert-rule-group/${e}`,{method:Me.Get})).then((e=>{const{success:t,dat:a}=e;t&&N(a)}))},O=(e,a=!1)=>{(null==_?void 0:_.id)&&t.push(`/strategy/edit/${e}${a?"?mode=clone":""}`)},T=()=>{a.current.refreshList()},L=[{title:"级别",dataIndex:"priority",render:e=>d.createElement(R,{color:ot[e-1]},"P",e)},{title:"名称",dataIndex:"name",render:(e,t)=>d.createElement("div",{className:"table-active-text",onClick:()=>{O(t.id)}},e)},{title:"报警接收者",dataIndex:"notify_users_detail",render:e=>{const t=e||[];return t.length&&t.map(((e,t)=>d.createElement(rl,{text:e.nickname||e.username,key:t})))||d.createElement("div",null)}},{title:"附加标签",dataIndex:"append_tags",render:e=>{const t=e?e.split(" "):[];return t.length&&t.map(((e,t)=>d.createElement(rl,{text:e,key:t})))||d.createElement("div",null)}},{title:"创建时间",dataIndex:"create_at",render:e=>B(1e3*Number(e)).format("YYYY-MM-DD HH:mm:ss")},{title:"状态",dataIndex:"status",render:(e,t)=>d.createElement(Ee,{checked:e===Jn.Enable,size:"small",onChange:()=>{const{id:e,status:a}=t;(function(e,t){return Ve(`${Ue}/api/n9e/alert-rules/status`,{method:Me.Put,data:{ids:e,status:t}})})([e],a===Jn.Enable?Jn.UnEnable:Jn.Enable).then((()=>{T()}))}})},{title:"操作",dataIndex:"operator",render:(e,t)=>d.createElement("div",{className:"table-operator-area"},d.createElement("div",{className:"table-operator-area-normal",onClick:()=>{O(t.id,!0)}},"克隆"),d.createElement("div",{className:"table-operator-area-warning",onClick:()=>{ml({title:"是否删除该采集策略?",onOk:()=>{var e;(e=t.id,Ve(`${Ue}/api/n9e/alert-rule/${e}`,{method:Me.Delete})).then((()=>{S.success("删除成功"),T()}))},onCancel(){}})}},"删除"))}],A=d.useCallback((()=>Cn(!1,o,r(r({},b),{id:null==_?void 0:_.id}),(()=>{I()}))),[o,b,null==_?void 0:_.id]),V=d.useMemo((()=>d.createElement("ul",{className:"ant-dropdown-menu"},d.createElement("li",{className:"ant-dropdown-menu-item"},d.createElement("span",{onClick:()=>s(ol.Import)},"导入")),d.createElement("li",{className:"ant-dropdown-menu-item"},d.createElement("span",{onClick:()=>{if(g.length){const e=g.map((e=>r(r({},e),ul)));k(JSON.stringify(e,null,2)),s(ol.Export)}else S.warning("未选择任何采集策略")}},"导出")),d.createElement("li",{className:"ant-dropdown-menu-item"},d.createElement("span",{onClick:()=>{E.length?ml({title:"是否批量删除采集策略?",onOk:()=>{var e,t;(e=null==_?void 0:_.id,t=E,Ve(`${Ue}/api/n9e/alert-rule-group/${e}/alert-rules`,{method:Me.Delete,data:{ids:t}})).then((()=>{S.success("删除成功"),T()}))},onCancel(){}}):S.warning("未选择任何采集策略")}},"删除")))),[E]),M=d.createElement("ul",{className:"ant-dropdown-menu"},x.map(((e,t)=>d.createElement("li",{className:"ant-dropdown-menu-item",key:t},d.createElement("span",{onClick:()=>z(e)},e))))),z=async e=>{let{dat:t}=await Zt("alert_rule",e);await vn(t.map((e=>r(r({},e),{group_id:null==_?void 0:_.id})))),T()};return d.createElement("div",{className:"strategy-table-content"},d.createElement("div",{className:"strategy-table-title"},d.createElement("div",{className:"strategy-table-title-label"},(null==_?void 0:_.name)||"",d.createElement(ht,r({},A())),_&&d.createElement(pe,{onClick:e=>{e.stopPropagation(),ml({title:"是否确定删除该策略分组?",icon:d.createElement(D,null),onOk:()=>{n({type:"strategy/deleteGroup",id:null==_?void 0:_.id})},onCancel(){}})},style:{marginLeft:8}})),d.createElement("div",{className:"strategy-table-title-sub"},d.createElement("div",{className:"strategy-table-title-sub-item"},"管理团队:",(null==(e=null==b?void 0:b.user_groups)?void 0:e.map((e=>e.name)).join(" "))||"-"))),d.createElement("div",{className:"strategy-table-search table-handle"},d.createElement("div",{className:"strategy-table-search-left"},d.createElement(Oa,{className:"strategy-table-search-left-refresh",onClick:()=>{T()}}),d.createElement(nt,{className:"searchInput",placeholder:"请输入告警策略名称",onSearch:$,allowClear:!0})),d.createElement("div",{className:"strategy-table-search-right"},d.createElement(p,{type:"primary",onClick:()=>{(null==_?void 0:_.id)&&t.push(`/strategy/add/${_.id}`)},className:"strategy-table-search-right-create"},"新建告警策略"),d.createElement("div",{className:"table-more-options"},d.createElement(F,{overlay:M,trigger:["click"]},d.createElement(p,{onClick:e=>e.stopPropagation()},"导入内置策略",d.createElement(G,{style:{marginLeft:2}}))),d.createElement(F,{overlay:V,trigger:["click"]},d.createElement(p,{onClick:e=>e.stopPropagation()},"更多操作",d.createElement(G,{style:{marginLeft:2}})))))),d.createElement(Dt,{ref:a,rowKey:"id",columns:L,fetchParams:{id:(null==_?void 0:_.id)||"",query:P},fePaging:!0,autoFetch:!1,initFetch:u,feQueryParams:["name"],fetchHandle:pn,rowSelection:{selectedRowKeys:E,onChange:(e,t)=>{f(e),y(t)}}}),d.createElement(cl,{status:l,onClose:()=>s(ol.None),onSubmit:e=>{try{let t=JSON.parse(e);return vn(t.map((e=>r(r({},e),{group_id:null==_?void 0:_.id})))).then((()=>T()))}catch(t){return Promise.reject(t)}},title:"策略",exportData:v}))};const pl=()=>d.createElement("div",{className:"strategy-content"},d.createElement(jn,{pageTitle:"告警策略",typeName:"策略",pathKey:"name",treeType:"strategy"}),d.createElement(dl,null));const hl=({icon:e,title:t,rightArea:a,children:n,customArea:l,showBack:r})=>d.createElement("div",{className:"page-wrapper"},l?d.createElement("div",{className:"page-top-header"},l):d.createElement("div",{className:"page-top-header"},d.createElement("div",{className:"page-header-content"},d.createElement("div",{className:"page-header-title"},r&&d.createElement(fe,{onClick:()=>window.history.back(),style:{marginRight:"5px"}}),e,t),d.createElement("div",{className:"page-header-right-area"},a))),n&&n);const{confirm:El}=$;function fl(){const[e]=_.useForm(),t=d.useRef(null),a=m(),[n,l]=d.useState(!1),[s,o]=d.useState(ol.None),[c,u]=d.useState([]),[h,E]=d.useState(""),[f,g]=d.useState(!1),[y,v]=d.useState(""),[k,b]=d.useState([]);d.useState("");const[N,C]=d.useState();d.useEffect((()=>{Xt("dashboard").then((e=>{b(e.dat)}))}),[]);const w=async()=>{let{name:t,tags:a}=e.getFieldsValue();return n={name:t,tags:a},Ve(`${Ue}/api/n9e/dashboards`,{method:Me.Post,data:n});var n},I=async()=>{if(null==N?void 0:N.id){const{dat:a}=await Mt(null==N?void 0:N.id);return t=Object.assign(N,e.getFieldsValue(),{configs:a.configs}),Ve(`${Ue}/api/n9e/dashboards-clone`,{method:Me.Post,data:t})}throw new Error("没有选择大盘");var t},O=[{title:"大盘名称",dataIndex:"name",render:(e,t)=>d.createElement("div",{className:"table-active-text",onClick:()=>a.push("/dashboard/"+t.id)},e)},{title:"分类标签",dataIndex:"tags",render:e=>d.createElement(d.Fragment,null,e.split(" ").map(((e,t)=>e?d.createElement(R,{color:"blue",key:t,style:{cursor:"pointer"},onClick:()=>(e=>{(y.length>0?y.split(" "):[]).includes(e)||v((t=>t+" "+e))})(e)},e):null)))},{title:"更新时间",dataIndex:"update_at",render:e=>B(1e3*e).format("YYYY-MM-DD HH:mm:ss")},{title:"发布人",dataIndex:"create_by"},{title:"操作",width:"240px",render:(a,n)=>d.createElement("div",{className:"table-operator-area"},d.createElement("div",{className:"table-operator-area-normal",onClick:()=>(t=>{const{id:a,name:n,tags:r}=t,s="Copy of "+n;e.setFieldsValue({name:s,tags:r}),C({id:a}),l(!0),g(!0)})(n)},"克隆"),d.createElement("div",{className:"table-operator-area-warning",onClick:async()=>{El({title:`是否删除大盘${n.name}?`,onOk:async()=>{var e,a;await(a=n.id,Ve(`${Ue}/api/n9e/dashboard/${a}`,{method:Me.Delete})),S.success("删除大盘成功"),null==(e=null==t?void 0:t.current)||e.refreshList()},onCancel(){}})}},"删除"))}],D=d.createElement("ul",{className:"ant-dropdown-menu"},d.createElement("li",{className:"ant-dropdown-menu-item"},d.createElement("span",{onClick:()=>o(ol.Import)},"导入")),d.createElement("li",{className:"ant-dropdown-menu-item"},d.createElement("span",{onClick:async()=>{if(c.length){let t=await(e=c,Ve(`${Ue}/api/n9e/dashboards/export`,{method:Me.Post,data:{ids:e}}));E(JSON.stringify(t.dat,null,2)),o(ol.Export)}else S.warning("未选择任何大盘");var e}},"导出"))),T=d.createElement("ul",{className:"ant-dropdown-menu"},k.map(((e,a)=>d.createElement("li",{className:"ant-dropdown-menu-item",key:a},d.createElement("span",{onClick:()=>(async e=>{var a;let{dat:n}=await Zt("dashboard",e);await Vt(n),null==(a=null==t?void 0:t.current)||a.refreshList()})(e)},e)))));return d.createElement(hl,{title:"监控大盘",icon:d.createElement(ge,null)},d.createElement("div",{className:"dashboard"},d.createElement("div",{className:"table-handle"},d.createElement("div",{className:"table-handle-search"},d.createElement(x,{onPressEnter:e=>{let t=e.target.value;v(t)},className:"searchInput",value:y,prefix:d.createElement(P,null),placeholder:"大盘名称"})),d.createElement("div",{className:"table-handle-buttons"},d.createElement(p,{type:"primary",onClick:()=>{l(!0)}},"新建大盘"),d.createElement("div",{className:"table-more-options"},d.createElement(F,{overlay:T,trigger:["click"]},d.createElement(p,{onClick:e=>e.stopPropagation()},"导入内置大盘",d.createElement(G,{style:{marginLeft:2}}))),d.createElement(F,{overlay:D,trigger:["click"]},d.createElement(p,{onClick:e=>e.stopPropagation()},"更多操作",d.createElement(G,{style:{marginLeft:2}})))))),d.createElement(Dt,{ref:t,fetchHandle:At,fetchParams:{query:y},columns:O,rowKey:"id",rowSelection:{selectedRowKeys:c,onChange:e=>{u(e)}}})),d.createElement($,{title:f?"克隆监控大盘":"创建新监控大盘",visible:n,onOk:async()=>{var a;await e.validateFields(),f?(await I(),S.success("克隆大盘成功")):(await w(),S.success("新建大盘成功")),null==(a=null==t?void 0:t.current)||a.refreshList(),l(!1),g(!1)},onCancel:()=>{l(!1)}},d.createElement(_,r(r({},{labelCol:{span:4},wrapperCol:{span:16}}),{form:e}),d.createElement(_.Item,{label:"大盘名称",name:"name",wrapperCol:{span:24},rules:[{required:!0,message:"请输入大盘名称"}]},d.createElement(x,null)),d.createElement(_.Item,{wrapperCol:{span:24},label:"分类标签",name:"tags"},d.createElement(x,null)))),d.createElement(cl,{status:s,onClose:()=>o(ol.None),onSubmit:e=>{try{let a=JSON.parse(e);return Vt(a).then((()=>{var e;return null==(e=null==t?void 0:t.current)?void 0:e.refreshList()}))}catch(a){return i.error({message:(null==a?void 0:a.message)||"您的网络发生异常，无法连接服务器"}),Promise.reject(a)}},title:"大盘",exportData:h}))}function gl(){const{ids:e}=ue(),[t,a]=d.useState(),[n,l]=d.useState();d.useEffect((()=>{s()}),[]);const s=()=>{(function(e){return Ve(`${Ue}/api/n9e/charts/tmps?ids=${e}`,{method:Me.Get})})(e).then((e=>{try{let t=e.dat.filter((e=>!!e)).map((e=>JSON.parse(e.configs)));a(t)}catch(t){console.log(t)}}))};return d.createElement("div",{className:"chart-container"},t&&t.length>0?d.createElement(d.Fragment,null,d.createElement("div",{className:"chart-container-header"},d.createElement(Pa,{onChange:e=>{l(e)},initValue:t[0].options.range}),d.createElement(Oa,{onClick:()=>{s()},className:"reload-icon"})),t.map(((e,t)=>{const a=n?r(r({},e.options),{range:n}):e.options;return d.createElement($a,{key:t,options:a,title:e.title})}))):d.createElement("h2",{className:"holder"},d.createElement(ye,{style:{fontSize:"30px"}}),d.createElement("span",null,"该分享链接无图表数据")))}d.lazy((()=>et((()=>__import__("./about.545d70bf.js")),["/assets/about.545d70bf.js","/assets/vendor.6a8dc018.js"])));const yl=d.lazy((()=>et((()=>__import__("./profile.78bfe0d4.js")),["/assets/profile.78bfe0d4.js","/assets/profile.85fa6c43.css","/assets/vendor.6a8dc018.js"]))),vl=d.lazy((()=>et((()=>__import__("./detail.1f3a1dc0.js")),["/assets/detail.1f3a1dc0.js","/assets/detail.0393fa2b.css","/assets/vendor.6a8dc018.js"]))),kl=d.lazy((()=>et((()=>__import__("./index.28ec2b60.js")),["/assets/index.28ec2b60.js","/assets/index.56dea592.css","/assets/vendor.6a8dc018.js"]))),bl=d.lazy((()=>et((()=>Promise.resolve().then((function(){return Ga}))),void 0))),Nl=d.lazy((()=>et((()=>__import__("./index.b8d3a082.js")),["/assets/index.b8d3a082.js","/assets/index.ca93d180.css","/assets/vendor.6a8dc018.js"]))),_l=d.lazy((()=>et((()=>__import__("./operate.fd596ed8.js")),["/assets/operate.fd596ed8.js","/assets/vendor.6a8dc018.js"]))),Cl=d.lazy((()=>et((()=>__import__("./index.4efcc0b5.js")),["/assets/index.4efcc0b5.js","/assets/vendor.6a8dc018.js","/assets/index.de3aaf26.js","/assets/index.a08d2525.css"]))),xl=d.lazy((()=>et((()=>__import__("./add.e993dc15.js")),["/assets/add.e993dc15.js","/assets/vendor.6a8dc018.js","/assets/operateForm.17fdc8a4.js","/assets/index.de3aaf26.js","/assets/index.a08d2525.css"]))),wl=d.lazy((()=>et((()=>__import__("./detail.f9fc8de3.js")),["/assets/detail.f9fc8de3.js","/assets/vendor.6a8dc018.js","/assets/index.de3aaf26.js","/assets/index.a08d2525.css","/assets/operateForm.17fdc8a4.js"]))),Pl=d.lazy((()=>et((()=>__import__("./index.04087c22.js")),["/assets/index.04087c22.js","/assets/index.8bb41084.css","/assets/vendor.6a8dc018.js","/assets/index.e28e6ead.js"]))),Sl=d.lazy((()=>et((()=>__import__("./detail.68d9d01b.js")),["/assets/detail.68d9d01b.js","/assets/index.8bb41084.css","/assets/vendor.6a8dc018.js","/assets/index.e28e6ead.js"]))),$l=d.lazy((()=>et((()=>__import__("./index.6b4900db.js")),["/assets/index.6b4900db.js","/assets/index.c603f7af.css","/assets/vendor.6a8dc018.js","/assets/index.e28e6ead.js"])));function Il(){let{profile:e}=c((e=>e.account));const t=u(),a=C();return e.id||"/login"==t.pathname||t.pathname.startsWith("/chart/")||a({type:"account/getProfile"}),d.createElement("div",{className:"content"},d.createElement(ve,null,d.createElement(ke,{path:"/login",component:at,exact:!0}),d.createElement(ke,{exact:!0,path:"/overview",component:tt($l)}),d.createElement(ke,{path:"/metric/explorer",component:tt(bl),exact:!0}),d.createElement(ke,{path:"/account/profile/:tab",component:tt(yl)}),d.createElement(ke,{path:"/manage/:type",component:tt(kl)}),d.createElement(ke,{path:"/dashboard/:id",component:tt(vl)}),d.createElement(ke,{path:"/dashboard",component:fl}),d.createElement(ke,{path:"/chart/:ids",component:gl}),d.createElement(ke,{path:"/resource/:id?",component:Un}),d.createElement(ke,{path:"/indicator",component:tt(Nl)}),d.createElement(ke,{exact:!0,path:"/strategy/add/:group_id",component:tt(_l)}),d.createElement(ke,{exact:!0,path:"/strategy/edit/:id",component:tt(_l)}),d.createElement(ke,{exact:!0,path:"/strategy/:id?",component:pl}),d.createElement(ke,{exact:!0,path:"/shield",component:tt(Cl)}),d.createElement(ke,{exact:!0,path:"/shield/add/:from?",component:tt(xl)}),d.createElement(ke,{exact:!0,path:"/shield/detail/:id",component:tt(wl)}),d.createElement(ke,{exact:!0,path:"/event",component:tt(Pl)}),d.createElement(ke,{exact:!0,path:"/event/:id",component:tt(Sl)}),d.createElement(ke,{path:"/",exact:!0},d.createElement(be,{to:"/overview"}))))}const Ol="@@DVA_LOADING/SHOW",Dl="@@DVA_LOADING/HIDE";function Fl(e){return()=>t=>a=>{const{type:n}=a;return function(t){if(!t||"string"!=typeof t)return!1;const[a]=t.split("/"),n=e._models.filter((e=>e.namespace===a))[0];if(n&&n.effects&&n.effects[t])return!0;return!1}(n)?new Promise(((e,n)=>{t(r({__dva_resolve:e,__dva_reject:n},a))})):t(a)}}const Gl=new class{constructor(e){this.hooks=e.reduce(((e,t)=>(e[t]=[],e)),{})}use(e){const{hooks:t}=this;for(let a in e)t[a].push(e[a])}get(e){return"extraReducers"===e?Object.assign({},...this.hooks[e]):this.hooks[e]}}(["onEffect","extraReducers"]),Tl=new class{constructor(e){this.noop=e=>{},this._models=[],this.store={},this.plugin=e}addModel(e){const t=this.prefixResolve(e);this._models.push(t)}removeModel(){}prefixResolve(e){return e.reducers&&(e.reducers=this.prefix(e.reducers,e.namespace)),e.effects&&(e.effects=this.prefix(e.effects,e.namespace)),e}prefix(e,t){return Object.keys(e).reduce(((a,n)=>(a[t+"/"+n]=e[n],a)),{})}getReducer(){let e={};for(let a of this._models)e[a.namespace]=function(e=a.state,t){let n=a.reducers[t.type];return n?n(e,t):e};let t=this.plugin.get("extraReducers");return Ne(r(r({},e),t))}getSagas(){let e=[];const t=this;for(let a of this._models)e.push((function*(){for(const e in a.effects){const n=t.getWatcher(e,a.effects[e],a,t.plugin.get("onEffect"));yield Pe(n)}}));return e}prefixType(e,t){return-1===e.indexOf("/")?t.namespace+"/"+e:e}getWatcher(e,t,a,n){const l=this,s=e=>$e(r(r({},e),{type:this.prefixType(e.type,a)}));return function*(){yield _e(e,(function*(o){if(n)for(const l of n)t=l(t,r(r({},Se),{put:s}),a,e);const{__dva_resolve:i=l.noop}=o||{};try{i(yield t(o,r(r({},Se),{put:s})))}catch(c){console.error(c)}}))}}start(){let e=this.getReducer(),t=this.getSagas(),a=Ce();this.store=xe(Fl(this),a)(we)(e),t.forEach(a.run)}}(Gl);Tl.plugin.use(function(){let e={effects:{}};return{onEffect:function(e,{put:t},a,n){const{namespace:l}=a;return function*(...a){try{return yield t({type:Ol,payload:{namespace:l,actionType:n}}),yield e(...a)}finally{yield t({type:Dl,payload:{namespace:l,actionType:n}})}}},extraReducers:{loading(t=e,{type:a,payload:n}){let{actionType:l}=n||{};switch(a){case Ol:return{effects:r(r({},t.effects),{[l]:!0})};case Dl:return{effects:r(r({},t.effects),{[l]:!1})};default:return t}}}}}());const Ll={namespace:"resource",state:{tableData:[],pageNumber:1,group:{favorite:[],common:[],currentPage:1,commonTotal:0},currentGroup:null,prefix:aa.UnNeed,resourceData:{resourceDetail:null,resourceDetailLoading:!1}},reducers:{saveData:(e,t)=>r(r({},e),{[t.prop]:t.data}),saveResourceGroupData:(e,{data:t})=>r(r({},e),{group:r(r({},e.group),t)}),saveResourceData:(e,{data:t})=>r(r({},e),{resourceData:r(r({},e.resourceData),t)})},effects:{*updatePrefix({data:e},{put:t}){yield t({type:"saveData",prop:"prefix",data:e})},*chooseGroupItem({data:e},{put:t,select:a}){const{currentGroup:n}=yield a((e=>e.resource));e&&e.id&&(n&&n.id===e.id||(yield t({type:"saveData",prop:"currentGroup",data:e})))},*getResourceItem({id:e},{call:t,put:a}){yield a({type:"saveResourceData",data:{resourceDetailLoading:!0}});const{success:n,dat:l}=yield t(xt,e);n&&(yield a({type:"saveResourceData",data:{resourceDetail:l}})),yield a({type:"saveResourceData",data:{resourceDetailLoading:!1}})},*getGroup({sign:e,data:t=""},{put:a,select:n,call:l}){var s,o,i;const{currentGroup:c}=yield n((e=>e.resource));if("init"===e||"refresh"===e){const[n,l]=yield Promise.all([ft("",1),Ve(`${Ue}/api/n9e/classpaths/favorites`,{method:Me.Get})]);if(n.success){const m=(null==(s=null==l?void 0:l.dat)?void 0:s.map((e=>r(r({},e),{isFavorite:!0,isBelongIn:He.Favorite}))))||[],u=(null==(o=null==n?void 0:n.dat)?void 0:o.list.map((e=>r(r({},e),{isFavorite:!!m.find((t=>t.id===e.id)),isBelongIn:He.Common}))))||[],d=(null==(i=null==n?void 0:n.dat)?void 0:i.total)||0;if(yield a({type:"saveResourceGroupData",data:{favorite:m,common:u,commonTotal:d,currentPage:1}}),"init"===e&&t&&""!==t){const e=u.find((e=>e.id===Number(t)));yield a({type:"saveData",prop:"currentGroup",data:e})}else if(c){const e=u.find((e=>e.id===c.id));e?yield a({type:"saveData",prop:"currentGroup",data:e}):yield a({type:"saveData",prop:"currentGroup",data:u[0]})}else yield a({type:"saveData",prop:"currentGroup",data:u[0]})}}else if("search"===e){const{group:{favorite:e}}=yield n((e=>e.resource)),{success:s,dat:o}=yield l(ft,t);if(s){const t=(null==o?void 0:o.total)||0,n=(null==o?void 0:o.list.map((t=>r(r({},t),{isFavorite:!!e.find((e=>e.id===t.id)),isBelongIn:He.Common}))))||[];yield a({type:"saveResourceGroupData",data:{common:n,commonTotal:t,currentPage:1}}),(c||c.id)&&e.find((e=>e.id===c.id))&&n.find((e=>e.id===c.id))||(yield a({type:"saveData",prop:"currentGroup",data:n[0]}))}}else if("append"===e){const{group:{common:e,favorite:t,currentPage:s}}=yield n((e=>e.resource)),{success:o,dat:i}=yield l(ft,"",s+1);if(o){const n=(null==i?void 0:i.total)||0,l=(null==i?void 0:i.list.map((e=>r(r({},e),{isFavorite:!!t.find((t=>t.id===e.id)),isBelongIn:He.Common}))))||[];yield a({type:"saveResourceGroupData",data:{common:e.concat(l),commonTotal:n,currentPage:s+1}})}}},*changeGroupFavorite({id:e,favorType:t},{put:a,call:n}){const l=t===je.Add?gt:yt,{success:r}=yield n(l,e);r&&(yield a({type:"getGroup",sign:"refresh"}))},*deleteGroup({id:e},{call:t,put:a}){const{success:n}=yield t(vt,e);n&&(yield a({type:"getGroup",sign:"refresh"}))},*updateGroup({id:e,data:t},{call:a,put:n}){const{success:l}=yield a(kt,r(r({},t),{id:e}));l&&(yield n({type:"getGroup",sign:"refresh"}))}}},Rl=function(e){return Ve(`${Ue}/api/n9e/self/profile`,{method:Me.Put,data:e})},Al=function(){return Ve(`${Ue}/api/n9e/self/profile`,{method:Me.Get})},Vl="api/n9e/self/token",Ml=function(){return Ve(`${Ue}/${Vl}`,{method:Me.Get})},zl=function(e){return Ve(`${Ue}/${Vl}`,{method:Me.Put,data:e})},jl=function(){return Ve(`${Ue}/${Vl}`,{method:Me.Post})},Bl={namespace:"account",state:{num:0,profile:{nickname:"",role:"",roles:[],username:"",email:"",phone:"",id:0,portrait:"",contacts:{}},csrfToken:""},reducers:{SET_PROFILE:(e,t)=>r(r({},e),{profile:t.profile})},effects:{*login({username:e,password:t},{put:a,call:n,select:l}){const{dat:r,err:s}=yield n(Ke,e,t);yield a({type:"SET_PROFILE",profile:r});const{dat:o}=yield n(Je);return localStorage.setItem("csrfToken",o),s},*getProfile({},{put:e,call:t,select:a}){const{dat:n,err:l}=yield t(Al);return yield e({type:"SET_PROFILE",profile:n}),l},*updateProfile({data:e},{put:t,call:a,select:n}){const{dat:l,err:r}=yield a(Rl,e);return yield t({type:"SET_PROFILE",profile:e}),r}}},Hl={namespace:"strategy",state:{group:{favorite:[],common:[],currentPage:1,commonTotal:0},currentGroup:null},reducers:{saveData:(e,t)=>r(r({},e),{[t.prop]:t.data}),saveStrategyGroupData:(e,{data:t})=>r(r({},e),{group:r(r({},e.group),t)})},effects:{*chooseGroupItem({data:e},{put:t,select:a}){const{currentGroup:n}=yield a((e=>e.strategy));e&&e.id&&(n&&n.id===e.id||(yield t({type:"saveData",prop:"currentGroup",data:e})))},*getGroup({sign:e,data:t=""},{put:a,select:n,call:l}){var s,o,i;const{currentGroup:c}=yield n((e=>e.strategy));if("init"===e||"refresh"===e){const[n,l]=yield Promise.all([cn("",1),Ve(`${Ue}/api/n9e/alert-rule-groups/favorites`,{method:Me.Get})]);if(n.success){const m=(null==(s=null==l?void 0:l.dat)?void 0:s.map((e=>r(r({},e),{isFavorite:!0,isBelongIn:He.Favorite}))))||[],u=(null==(o=null==n?void 0:n.dat)?void 0:o.list.map((e=>r(r({},e),{isFavorite:!!m.find((t=>t.id===e.id)),isBelongIn:He.Common}))))||[],d=(null==(i=null==n?void 0:n.dat)?void 0:i.total)||0;if(yield a({type:"saveStrategyGroupData",data:{favorite:m,common:u,commonTotal:d,currentPage:1}}),"init"===e&&t&&""!==t){const e=u.find((e=>e.id===Number(t)));yield a({type:"saveData",prop:"currentGroup",data:e})}else if(c){const e=u.find((e=>e.id===c.id));e?yield a({type:"saveData",prop:"currentGroup",data:e}):yield a({type:"saveData",prop:"currentGroup",data:u[0]})}else yield a({type:"saveData",prop:"currentGroup",data:u[0]})}}else if("search"===e){const{group:{favorite:e}}=yield n((e=>e.strategy)),{success:s,dat:o}=yield l(cn,t);if(s){const t=(null==o?void 0:o.total)||0,n=(null==o?void 0:o.list.map((t=>r(r({},t),{isFavorite:!!e.find((e=>e.id===t.id)),isBelongIn:He.Common}))))||[];yield a({type:"saveStrategyGroupData",data:{common:n,commonTotal:t,currentPage:1}}),(c||c.id)&&e.find((e=>e.id===c.id))&&n.find((e=>e.id===c.id))||(yield a({type:"saveData",prop:"currentGroup",data:n[0]}))}}else if("append"===e){const{group:{common:e,favorite:t,currentPage:s}}=yield n((e=>e.strategy)),{success:o,dat:i}=yield l(cn,"",s+1);if(o){const n=(null==i?void 0:i.total)||0,l=(null==i?void 0:i.list.map((e=>r(r({},e),{isFavorite:!!t.find((t=>t.id===e.id)),isBelongIn:He.Common}))))||[];yield a({type:"saveStrategyGroupData",data:{common:e.concat(l),commonTotal:n,currentPage:s+1}})}}},*changeGroupFavorite({id:e,favorType:t},{put:a,call:n}){const l=t===je.Add?hn:En,{success:r}=yield n(l,e);r&&(yield a({type:"getGroup",sign:"refresh"}))},*deleteGroup({id:e},{call:t,put:a}){const{success:n}=yield t(un,e);n&&(yield a({type:"getGroup",sign:"refresh"}))},*updateGroup({id:e,data:t},{call:a,put:n}){const{success:l}=yield a(dn,e,t);l&&(yield n({type:"getGroup",sign:"refresh"}))}}},ql={namespace:"event",state:{currentEdit:null},reducers:{saveData:(e,t)=>r(r({},e),{[t.prop]:t.data})},effects:{*editItem({data:e},{put:t,select:a}){const{currentEdit:n}=yield a((e=>e.event));e&&e.id&&(n&&n.id===e.id||(yield t({type:"saveData",prop:"currentEdit",data:e})))}}};Tl.addModel(Ll),Tl.addModel(Bl),Tl.addModel(Hl),Tl.addModel(ql),Tl.start();var Ul=Tl.store;function Kl(){return d.createElement("div",{className:"App"},d.createElement(Ie,{locale:Oe,getPopupContainer:e=>e?e.parentNode:document.body},d.createElement(De,{store:Ul},d.createElement(Fe,null,d.createElement(lt,null,d.createElement(Qe,null),d.createElement(Il,null))))))}ae.locale("en"),Ge.render(d.createElement(Kl,null),document.getElementById("root"));export{vn as $,xn as A,Dt as B,jl as C,Pa as D,Pn as E,On as F,Ml as G,Sn as H,Fn as I,Gn as J,An as K,Tn as L,Ln as M,Rn as N,wn as O,hl as P,Dn as Q,Oa as R,Ve as S,Ue as T,Ye as U,Me as V,ct as W,gn as X,fn as Y,Vn as Z,yn as _,zl as a,rl as a0,nl as a1,Aa as a2,st as a3,nt as a4,Nn as a5,kn as a6,ot as a7,bn as a8,Jt as b,$a as c,da as d,ua as e,ba as f,Mn as g,Nt as h,ft as i,Kt as j,Ut as k,Qt as l,He as m,Rt as n,rt as o,Lt as p,Mt as q,Bt as r,zt as s,Wt as t,Yt as u,jt as v,qt as w,Ht as x,$n as y,In as z};
