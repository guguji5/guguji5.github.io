var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,r=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,n=(e,n)=>{for(var s in n||(n={}))t.call(n,s)&&r(e,s,n[s]);if(a)for(var s of a(n))l.call(n,s)&&r(e,s,n[s]);return e};import{r as s,F as m,I as c,t as i,as as o,Z as u,_ as d,q as E,j as p,l as f,B as y,k as h,P as v,aC as g,aD as b,a4 as I,u as k,R as C,w as S,aE as x,aF as w,aG as T,T as U,a8 as F}from"./vendor.6a8dc018.js";import{g as P,y as N,z as O,B as j,A as q,E as R,F as z,H as A,I as K,J as H,K as L,L as B,M as V,N as _,O as G,Q as D}from"./index.366ccd84.js";const J={labelCol:{span:4},wrapperCol:{span:20}},M=[{value:"Admin",label:"管理员"},{value:"Standard",label:"普通用户"},{value:"Guest",label:"游客"}],{Option:Q}=i,Z=s.forwardRef(((e,r)=>{const{userId:E}=e,[p]=m.useForm(),[f,y]=s.useState(),[h,v]=s.useState(!0),[g,b]=s.useState([]);s.useImperativeHandle(r,(()=>({form:p}))),s.useEffect((()=>{E?k(E):v(!1),I()}),[]);const I=()=>{P().then((e=>{b(e)}))},k=e=>{N(e).then((e=>{let t=[];e.contacts&&Object.keys(e.contacts).forEach((a=>{let l={key:a,value:e.contacts[a]};t.push(l)})),y(Object.assign({},e,{contacts:t})),v(!1)}))};return h?null:s.createElement(m,n(n({},J),{form:p,initialValues:f,preserve:!1}),!E&&s.createElement(m.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"用户名不能为空！"}]},s.createElement(c,null)),s.createElement(m.Item,{label:"显示名",name:"nickname"},s.createElement(c,null)),!E&&s.createElement(s.Fragment,null,s.createElement(m.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码!"}],hasFeedback:!0},s.createElement(c.Password,null)),s.createElement(m.Item,{name:"confirm",label:"确认密码",dependencies:["password"],hasFeedback:!0,rules:[{required:!0,message:"请确认密码!"},({getFieldValue:e})=>({validator:(t,a)=>a&&e("password")!==a?Promise.reject(new Error("密码不一致!")):Promise.resolve()})]},s.createElement(c.Password,null))),s.createElement(m.Item,{label:"角色",name:"roles",rules:[{required:!0,message:"角色不能为空！"}]},s.createElement(i,{mode:"multiple"},M.map(((e,t)=>s.createElement(Q,{value:e.value,key:t},e.value))))),s.createElement(m.Item,{label:"邮箱",name:"email"},s.createElement(c,null)),s.createElement(m.Item,{label:"手机",name:"phone"},s.createElement(c,null)),s.createElement(m.Item,{label:"更多联系方式"},s.createElement(m.List,{name:"contacts"},((e,{add:r,remove:E})=>s.createElement(s.Fragment,null,e.map((e=>{var{key:r,name:d,fieldKey:p}=e,f=((e,r)=>{var n={};for(var s in e)t.call(e,s)&&r.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&a)for(var s of a(e))r.indexOf(s)<0&&l.call(e,s)&&(n[s]=e[s]);return n})(e,["key","name","fieldKey"]);return s.createElement(o,{key:r,style:{display:"flex"},align:"baseline"},s.createElement(m.Item,n(n({style:{width:"180px"}},f),{name:[d,"key"],fieldKey:[p,"key"],rules:[{required:!0,message:"联系方式不能为空"}]}),s.createElement(i,{placeholder:"请选择联系方式"},g.map(((e,t)=>s.createElement(Q,{value:e.key,key:t},e.label))))),s.createElement(m.Item,n(n({},f),{style:{width:"330px"},name:[d,"value"],fieldKey:[p,"value"],rules:[{required:!0,message:"值不能为空"}]}),s.createElement(c,{placeholder:"请输入值"})),s.createElement(u,{className:"control-icon-normal",onClick:()=>E(d)}))})),s.createElement(d,{className:"control-icon-normal",onClick:()=>r()}))))))})),W=s.forwardRef(((e,t)=>{const{teamId:a}=e,[l]=m.useForm(),[r,i]=s.useState(),[o,u]=s.useState(!0);s.useImperativeHandle(t,(()=>({form:l}))),s.useEffect((()=>{a?d(a):u(!1)}),[]);const d=e=>{O(e).then((e=>{i(e.user_group),u(!1)}))};return o?null:s.createElement(m,n(n({},J),{form:l,initialValues:r,preserve:!1}),s.createElement(m.Item,{label:"团队名称",name:"name",rules:[{required:!0,message:"团队名称不能为空！"}]},s.createElement(c,null)),s.createElement(m.Item,{label:"备注",name:"note"},s.createElement(c,null)))})),X=s.forwardRef(((e,t)=>{const[a]=m.useForm();return s.useImperativeHandle(t,(()=>({form:a}))),s.createElement(m,n(n({},J),{form:a}),s.createElement(m.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码!"}],hasFeedback:!0},s.createElement(c.Password,null)),s.createElement(m.Item,{name:"confirm",label:"确认密码",dependencies:["password"],hasFeedback:!0,rules:[{required:!0,message:"请确认密码!"},({getFieldValue:e})=>({validator:(t,a)=>a&&e("password")!==a?Promise.reject(new Error("密码不一致!")):Promise.resolve()})]},s.createElement(c.Password,null)))}));const Y=e=>{const{teamId:t,onSelect:a}=e,[l,r]=s.useState(),[n,m]=s.useState([]),[i,o]=s.useState([]),[u,d]=s.useState("");s.useEffect((()=>{f()}),[]);const f=()=>{t&&O(t).then((e=>{r(e.user_group)}))};return s.createElement("div",null,s.createElement("div",null,s.createElement("span",null,"团队名称："),l&&l.name),s.createElement("div",{style:{margin:"20px 0 16px"}},n.length>0&&s.createElement("span",null,"已选择",n.length,"项："),i.map(((e,t)=>s.createElement(E,{style:{marginBottom:"4px"},closable:!0,onClose:()=>(e=>{let t=i.filter((t=>t.id!==e.id)),a=t.map((e=>e.id));o(t),m(a)})(e),key:e.id},e.username)))),s.createElement(c,{className:"searchInput",prefix:s.createElement(p,null),value:u,onChange:e=>d(e.target.value),placeholder:"用户名、邮箱或电话",onPressEnter:e=>d(u)}),s.createElement(j,{fetchHandle:q,columns:[{title:"用户名",dataIndex:"username",ellipsis:!0},{title:"显示名",dataIndex:"nickname",ellipsis:!0,render:(e,t)=>t.nickname||"-"},{title:"邮箱",dataIndex:"email",render:(e,t)=>t.email||"-"},{title:"手机",dataIndex:"phone",render:(e,t)=>t.phone||"-"}],rowKey:"id",needPagination:!0,pageSize:5,fetchParams:{query:u},rowSelection:{selectedRowKeys:n,onChange:(e,t)=>{a(e),m(e),o(t)}}}))};var $,ee,te,ae,le,re;(ee=$||($={})).User="用户",ee.Team="团队",(ae=te||(te={})).CreateUser="创建用户",ae.CreateTeam="创建团队",ae.EditUser="编辑用户信息",ae.EditTeam="编辑团队信息",ae.Reset="重置密码",ae.Disable="禁用",ae.Undisable="启用",ae.AddUser="添加成员",(re=le||(le={})).Admin="管理员",re.Standard="普通用户",re.Guest="游客";const ne=e=>{const{visible:t,userType:a,onClose:l,action:r,userId:m,teamId:c,onSearch:i}=e,[o,u]=s.useState(),d=s.useRef(null),E=s.useRef(null),p=s.useRef(null),v=(r===te.CreateUser||r===te.EditUser)&&a===$.User,g=(r===te.CreateTeam||r===te.EditTeam)&&a===$.Team,b=r===te.Reset,I=r===te.AddUser,k=async e=>{if(v){let e=d.current.form;const t=await e.validateFields();let a={};t.contacts&&t.contacts.forEach((e=>{a[e.key]=e.value}));let s=n(n({},t),{contacts:a,confirm:void 0});r===te.CreateUser&&R(s).then((e=>{h.success("用户创建成功"),l()})),r===te.EditUser&&m&&z(m,s).then((e=>{h.success("用户信息修改成功"),l()}))}if(g){let t=E.current.form;const a=await t.validateFields();let s=n({},a);r===te.CreateTeam&&A(s).then((t=>{h.success("团队创建成功"),l(),"search"===e&&i(s.name)})),r===te.EditTeam&&c&&K(c,s).then((e=>{h.success("团队信息修改成功"),l()}))}if(b&&m){let e=p.current.form;const t=await e.validateFields();let a=n({},t);H(m,a).then((e=>{h.success("密码重置成功"),l()}))}if(I&&c){L(c,{ids:o}).then((e=>{h.success("添加成功"),l()}))}};return s.createElement(f,{title:r,visible:t,width:700,onCancel:l,destroyOnClose:!0,footer:[s.createElement(y,{key:"back",onClick:l},"取消"),s.createElement(y,{key:"submit",type:"primary",onClick:()=>k()},"确认"),r===te.CreateTeam&&s.createElement(y,{type:"primary",onClick:()=>k("search")},"确认并搜索")]},v&&s.createElement(Z,{ref:d,userId:m}),g&&s.createElement(W,{ref:E,teamId:c}),b&&s.createElement(X,{ref:p,userId:m}),I&&s.createElement(Y,{teamId:c,onSelect:e=>u(e)}))};const se=e=>{const{userId:t,teamId:a,memberId:l,userType:r,onClose:n,isIcon:m}=e,[c,i]=s.useState(!1);return s.createElement(v,{trigger:"click",visible:c,content:s.createElement("div",{className:"popover-wrapper"},s.createElement(g,{style:{marginRight:"4px",color:"#E6A23C"}}),"确定要删除么？",s.createElement("div",{className:"popover-content"},s.createElement(y,{type:"primary",size:"small",onClick:()=>("user"===r&&t&&B(t).then((e=>{h.success("用户删除成功"),n()})),"team"===r&&a&&V(a).then((e=>{h.success("团队删除成功"),n()})),void("member"===r&&a&&l&&_(a,{ids:[l]}).then((e=>{h.success("成员删除成功"),n()}))))},"确定"),s.createElement(y,{size:"small",onClick:()=>i(!1)},"取消")))},m?s.createElement(b,{style:{marginLeft:"8px",fontSize:"16px"},twoToneColor:"#ff4d4f",onClick:()=>i(!0)}):s.createElement(y,{className:"oper-name",type:"text",danger:!0,onClick:()=>i(!0)},"删除"))};export default()=>{const{type:e}=I(),[t,a]=s.useState($.User),[l,r]=s.useState(!1),[n,m]=s.useState(),[i,o]=s.useState(""),[u,d]=s.useState(""),[E,f]=s.useState(""),[v,g]=s.useState([]),[b,P]=s.useState(0),[N,R]=s.useState([]),[z,A]=s.useState(),[K,H]=s.useState([]),[L,B]=s.useState(""),[V,_]=s.useState(!1),[J,M]=s.useState(1),[Q,Z]=s.useState(10),[W,X]=s.useState(0),[Y,ee]=s.useState(""),[ae,le]=s.useState(""),re=s.useRef(null);let{profile:me}=k((e=>e.account));const ce=[{title:"用户名",dataIndex:"username",ellipsis:!0},{title:"显示名",dataIndex:"nickname",ellipsis:!0,render:(e,t)=>t.nickname||"-"},{title:"邮箱",dataIndex:"email",render:(e,t)=>t.email||"-"},{title:"手机",dataIndex:"phone",render:(e,t)=>t.phone||"-"}],ie=[...ce,{title:"角色",dataIndex:"role"},{title:"启用",width:"60px",render:(e,t)=>s.createElement(F,{checked:0===t.status,disabled:!me.roles.includes("Admin"),size:"small",onChange:()=>he(t.status,t.id)})},{title:"操作",width:"240px",render:(e,t)=>s.createElement(s.Fragment,null,s.createElement(y,{className:"oper-name",type:"link",onClick:()=>fe(te.EditUser,t.id)},"编辑"),s.createElement(y,{className:"oper-name",type:"link",onClick:()=>fe(te.Reset,t.id)},"重置密码"),s.createElement(se,{userId:t.id,userType:"user",onClose:()=>ye()}))}];me.roles.includes("Admin")||ie.pop();const oe=[...ce,{title:"操作",width:"100px",render:(e,t)=>s.createElement(se,{teamId:u,memberId:t.id,userType:"member",onClose:()=>ye()})}];s.useEffect((()=>{switch(e){case"user":a($.User);break;case"group":a($.Team);break;default:a($.User)}}),[]),s.useEffect((()=>{ue()}),[t]),s.useEffect((()=>{t===$.Team&&u&&Ee(u)}),[u]),s.useEffect((()=>{t===$.Team&&de()}),[J]);const ue=()=>{t===$.User?re.current.refreshList():de()},de=()=>{G({query:Y,p:J,limit:Q}).then((e=>{H(e.dat.list||[]),X(e.dat.total),u||d(e.dat.list[0].id)}))},Ee=e=>{_(!0),O(e).then((e=>{A(e.user_group),g(e.users),R(e.users),P(e.users.length),_(!1)}))},pe=(e,t)=>{if("team"===e)de();else if(t){_(!0);let e=N.filter((e=>-1!==e.username.indexOf(t)||-1!==e.id.toString().indexOf(t)||-1!==e.phone.indexOf(t)||-1!==e.email.indexOf(t)));g(e),_(!1)}else Ee(u)},fe=(e,a,l)=>{a?t===$.User?o(a):d(a):t===$.User?o(""):d(""),f(l||""),m(e),r(!0)},ye=()=>{r(!1),Y?pe("team",Y):ue(),u&&Ee(u)},he=(e,t)=>{if(0===e){D(t,{status:1}).then((e=>{h.success("禁用成功"),ye()}))}else{D(t,{status:0}).then((e=>{h.success("启用成功"),ye()}))}};return s.createElement("div",{className:"user-manage-content"},t===$.User&&s.createElement(s.Fragment,null,s.createElement("div",{className:"event-table-search"},s.createElement("div",{className:"event-table-search-left"},s.createElement(c,{className:"searchInput",prefix:s.createElement(p,null),onPressEnter:e=>{let t=e.target.value;B(t)},placeholder:"用户名、邮箱或手机"})),s.createElement("div",{className:"event-table-search-right"},t===$.User&&me.roles.includes("Admin")&&s.createElement("div",{className:"user-manage-operate"},s.createElement(y,{type:"primary",onClick:()=>fe(t===$.User?te.CreateUser:te.CreateTeam)},"创建",t)))),s.createElement(j,{ref:re,fetchHandle:q,columns:ie,rowKey:"id",needPagination:!0,fetchParams:{query:L}})),t===$.Team&&s.createElement(s.Fragment,null,s.createElement(C,null,s.createElement(S,{className:"left-content"},s.createElement("div",{className:"title"},"团队管理"),s.createElement(C,{justify:"space-between",align:"middle",style:{margin:"16px 0 12px"}},s.createElement(S,{span:"21"},s.createElement(c,{prefix:s.createElement(p,null),value:Y,onChange:e=>ee(e.target.value),placeholder:"搜索团队名称",onPressEnter:e=>pe("team",Y)})),s.createElement(S,null,s.createElement(y,{style:{height:"30px"},size:"small",type:"primary",onClick:()=>{fe(te.CreateTeam)}},"+"))),s.createElement(x,{style:{border:"1px solid #dbdee3",marginBottom:"12px"},dataSource:K,size:"small",renderItem:e=>s.createElement(x.Item,{key:e.id,className:u===e.id?"is-active":"",onClick:()=>d(e.id)},e.name)}),s.createElement(C,{justify:"center"},s.createElement(w,{simple:!0,current:J,pageSize:Q,onChange:M,total:W,onShowSizeChange:(e,t)=>{Z(t),M(1)}}))),s.createElement(S,{span:"17"},s.createElement(C,{className:"team-info"},s.createElement(S,{span:"24",style:{fontSize:"16px"}},z&&z.name,s.createElement(T,{style:{marginLeft:"16px",fontSize:"16px"},onClick:()=>fe(te.EditTeam,u)}),s.createElement(se,{teamId:u,userType:"team",isIcon:!0,onClose:()=>ye()})),s.createElement(S,{style:{marginTop:"8px",color:"#666"}},"备注： ",z&&z.note?z.note:"-")),s.createElement(C,{justify:"space-between",align:"middle"},s.createElement(S,{span:"12"},s.createElement(c,{prefix:s.createElement(p,null),value:ae,onChange:e=>le(e.target.value),placeholder:"成员名、邮箱或手机",onPressEnter:e=>pe("member",ae)})),s.createElement(y,{type:"primary",onClick:()=>{fe(te.AddUser,u)}},"添加成员")),s.createElement(U,{rowKey:"id",columns:oe,dataSource:v,loading:V})))),s.createElement(ne,{visible:l,action:n,userType:t,onClose:ye,onSearch:e=>{ee(e),pe("team",e)},userId:i,teamId:u,memberId:E}))};
