var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,s=(e,s)=>{for(var n in s||(s={}))t.call(s,n)&&l(e,n,s[n]);if(a)for(var n of a(s))r.call(s,n)&&l(e,n,s[n]);return e};import{a4 as n,u as m,r as i,F as o,b as c,v as d,aK as f,I as p,t as u,R as E,w as b,B as g,q as y,x as h,k as v}from"./vendor.6a8dc018.js";import{a1 as _,a2 as I,d as w,a3 as F}from"./index.366ccd84.js";import{a as j}from"./index.de3aaf26.js";const{Option:O}=u,{TextArea:Y}=p,x=/\s/g,M=({detail:e,type:t=_.add})=>{const a={labelCol:{span:2},wrapperCol:{span:22}},r=n(),{currentEdit:l}=m((e=>e.event)),[M,k]=i.useState([]),[C]=o.useForm(null),S=c(),[D,H]=i.useState(!1);i.useEffect((()=>{if(t===_.add&&"event"===r.from&&(null==l?void 0:l.id)){const{history_points:e,res_ident:t,tags:a}=l;C.setFieldsValue({metric:e[0].metric,res_filters:t,tags_filters:""===a?[]:a.split(" ")})}}),[r.from]);const V=(e,t,a)=>{let r=C.getFieldValue("metric"),l=C.getFieldValue("res_filters"),s=C.getFieldValue("tags_filters");r||l||s?a():a(new Error("屏蔽标识、资源标识、屏蔽标签不能同时为空"))},N=async e=>{const{dat:t,error:a}=await w({metric:e});k(t.metrics)};i.useEffect((()=>{N()}),[]);const P=t===_.add?i.createElement(o,s(s({form:C},a),{className:"operate-form",onFinish:e=>{H(!0);const t={metric:e.metric,res_filters:e.res_filters,tags_filters:(null==e?void 0:e.tags_filters)?e.tags_filters.join(" "):"",cause:e.cause,btime:e.time.btime,etime:e.time.etime};j(t).then((e=>{v.success("新建告警屏蔽成功"),S.push("/shield")})).finally((()=>{H(!1)}))},onFinishFailed:()=>{H(!1)}}),i.createElement(d,null,i.createElement(o.Item,{label:"屏蔽指标",name:"metric",rules:[{validator:V}]},i.createElement(f,{placeholder:"请输入指标名称",onSearch:N},M.map((e=>i.createElement(O,{key:e.name,value:e.name},e.name," ",e.description))))),i.createElement(o.Item,{label:"资源标识",name:"res_filters",rules:[{validator:V}]},i.createElement(p,{placeholder:"请输入资源标识的正则表达式"})),i.createElement(o.Item,{label:"屏蔽标签",name:"tags_filters",rules:[{validator:V}]},i.createElement(u,{mode:"tags",dropdownStyle:{display:"none"},placeholder:"请输入屏蔽标签(请用回车分割，禁止使用空格)",onChange:e=>{const t=e[e.length-1];if(t&&x.test(t)){let t=e.pop();v.error(`请检查"${t}"中的空格`)}}})),i.createElement(o.Item,{label:"屏蔽时间",name:"time"},i.createElement(I,null)),i.createElement(o.Item,{label:"屏蔽原因",name:"cause",rules:[{required:!0,message:"请填写屏蔽原因"}]},i.createElement(Y,{rows:3})),i.createElement(o.Item,s({},{wrapperCol:{offset:2}}),i.createElement(E,{gutter:[10,10],align:"middle"},i.createElement(b,{span:1},i.createElement(g,{type:"primary",htmlType:"submit",loading:D},"创建")),i.createElement(b,{span:1,style:{marginLeft:40}},i.createElement(g,{onClick:()=>window.history.back()},"取消")))))):e?i.createElement(o,s(s({},a),{className:"operate-form"}),i.createElement(d,null,i.createElement(o.Item,{label:"屏蔽指标"},e.metric||"暂无"),i.createElement(o.Item,{label:"资源标识"},e.res_filters||i.createElement("div",null,"暂无")),i.createElement(o.Item,{label:"屏蔽标签"},e.tags_filters&&e.tags_filters.split(" ").map(((e,t)=>{let a=Math.random()*F.length,r=F[Math.floor(a)];return i.createElement(y,{color:r,key:t},e)}))||i.createElement("div",null,"暂无")),i.createElement(o.Item,{label:"屏蔽时间"},h(1e3*e.btime).format("YYYY-MM-DD HH:mm:ss")," -"," ",h(1e3*e.etime).format("YYYY-MM-DD HH:mm:ss")),i.createElement(o.Item,{label:"屏蔽原因"},e.cause))):i.createElement("div",null);return i.createElement("div",{className:"operate-form-index"},P)};export{M as O};
